!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=60)}({12:function(e,t){e.exports=class{constructor({name:e}){this.name=e,this._hasTx=!1}async begin(){this._hasTx||(await this._begin(),this._hasTx=!0)}async commit(){this._hasTx&&(await this._commit(),this._hasTx=!1)}async rollback(){this._hasTx&&(await this._rollback(),this._hasTx=!1)}_begin(){}_commit(){}_rollback(){}}},14:function(e,t,r){const n=r(12),a=r(15);class s extends n{constructor(e){super(e),this.data=e.data||{}}load(e,t=(()=>{})){let r=this.data[e.schema.name]||[];const{criteria:n,sorts:a}=e;if(r=r.filter(t=>this._matchCriteria(n,t,e.schema)),a){const e=Object.keys(a);r=r.sort((t,r)=>{let n=0;return e.forEach((s,o)=>{const i=a[s],c=Math.pow(2,e.length-o-1)*i;t[s]<r[s]?n-=c:t[s]>r[s]&&(n+=c)}),n})}return e.offset<0?r:(r=e.length<0?r.slice(e.offset):r.slice(e.offset,e.offset+e.length)).map(e=>(t(e),e))}insert(e,t=(()=>{})){const r=this.data[e.schema.name]=this.data[e.schema.name]||[];return e.rows.reduce((n,s)=>{const o={id:a()};for(const t in s)o[t]=e.schema.getField(t).serialize(s[t]);return r.push(o),t(o),++n},0)}update(e){const t=Object.keys(e.sets);return this.load(e).reduce((r,n)=>{return t.filter(t=>n[t]!==e.sets[t]&&(n[t]=e.schema.getField(t).serialize(e.sets[t]),!0)).length&&r++,r},0)}drop(e){delete this.data[e.schema.name]}truncate(e){this.data[e.schema.name]=[]}delete(e){const t=this.data[e.schema.name]=this.data[e.schema.name]||[];this.load(e).forEach(e=>{const r=t.indexOf(e);r>=0&&t.splice(r,1)})}async count(e,t){const{length:r,offset:n}=e;t||(e.offset=0,e.length=-1);let a=0;return await this.load(e,()=>a++),e.offset=n,e.length=r,a}_matchCriteria(e,t,r){if(!e)return!0;for(const n in e){const a=e[n],[s,o="eq"]=n.split("!"),i=r.getField(s),c=t[s];switch(o){case"or":{let e=!1;for(const n of a){if(this._matchCriteria(n,t,r)){e=!0;break}}if(!e)return!1;break}case"and":for(const e of a)if(!this._matchCriteria(e,t,r))return!1;break;case"eq":if(0!==i.compare(a,c))return!1;break;case"ne":if(0===i.compare(a,c))return!1;break;case"gt":if(i.compare(a,c)<=0)return!1;break;case"gte":if(i.compare(a,c)<0)return!1;break;case"lt":if(i.compare(a,c)>=0)return!1;break;case"lte":if(i.compare(a,c)>0)return!1;break;case"in":if(-1===i.indexOf(a,c))return!1;break;case"nin":if(-1!==i.indexOf(a,c))return!1;break;case"like":{const e=new RegExp(a);if(!c.match(e))return!1;break}case"regex":if(!c.match(a))return!1;break;case"where":if(!a(c,t))return!1;break;default:throw new Error(`Operator '${o}' is not implemented yet!`)}}return!0}}if("undefined"!=typeof window){const e=window.norm;if(!e)throw new Error("Norm is not defined yet!");e.adapters=e.adapters||{},e.adapters.Memory=s}e.exports=s},15:function(e,t,r){var n=r(16),a=r(17);e.exports=function(e,t,r){var s=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||n)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var i=0;i<16;++i)t[s+i]=o[i];return t||a(o)}},16:function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},17:function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,a=r;return[a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]]].join("")}},60:function(e,t,r){if("undefined"==typeof window)throw new Error("IndexedDB adapter only works at browser");const n=r(14),a=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB;if(!window.indexedDB)throw new Error("Your browser doesn't support a stable version of IndexedDB. Such and such feature will not be available.");class s extends n{constructor({name:e,dbname:t="db",version:r=1,onUpgradeNeeded:n=(()=>{})}){super({name:e}),this.dbname=t,this.version=r,this.onUpgradeNeeded=n}async load(e,t=(()=>{})){const{criteria:r}=e,n=await this.__getStore(e.schema.name);(await new Promise((t,a)=>{const s=[],o=n.openCursor();o.onsuccess=n=>{const a=n.target.result;if(!a)return t(s);const o=a.value;this._matchCriteria(r,o,e.schema)&&s.push(o),a.continue()},o.onerror=function(e){a(e)}})).forEach(e=>t(e))}async insert(e,t=(()=>{})){const r=await this.__getStore(e.schema.name);let n=0;return await Promise.all(e.rows.map(async e=>{e.id=await this.__promised(r.add(e)),t(e),n++})),n}async update(e){const t=[];await this.load(e,e=>t.push(e));const r=await this.__getStore(e.schema.name),n=Object.keys(e.sets);let a=0;return await Promise.all(t.map(t=>{if(n.filter(r=>t[r]!==e.sets[r]&&(t[r]=e.sets[r],!0)).length)return a++,this.__promised(r.put(t))})),a}async delete(e){const t=[];await this.load(e,e=>t.push(e));const r=await this.__getStore(e.schema.name);await t.map(e=>this.__promised(r.delete(e.id)))}async truncate(e){const t=await this.__getStore(e.schema.name);await this.__promised(t.clear())}drop(e){return this.truncate(e)}async __getDB(){const e=a.open(this.dbname,this.version);return e.onupgradeneeded=this.onUpgradeNeeded,await this.__promised(e)}__promised(e){return new Promise((t,r)=>{e.onsuccess=e=>t(e.target.result),e.onerror=r})}async __getTx(e){return(await this.__getDB()).transaction(e,"readwrite")}async __getStore(e){return(await this.__getTx(e)).objectStore(e)}}if("undefined"!=typeof window){const e=window.norm;if(!e)throw new Error("Norm is not defined yet!");e.adapters=e.adapters||{},e.adapters.IndexedDB=s}e.exports=s}});
//# sourceMappingURL=indexeddb.min.js.map