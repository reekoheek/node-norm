!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=59)}({0:function(e,t,r){const n=r(12);e.exports=class{constructor(e){this.name=e,this.rawFilters=[],this.filters=[]}filter(...e){return e.forEach(e=>{try{e=n.tokenize(e)}catch(e){}this.rawFilters.push(e),this.filters.push(n.get(e))}),this}execFilter(e,{session:t,row:r,schema:n}){"string"==typeof e&&(e=e.trim());let i=this;return this.filters.reduce(async(e,o)=>o(await e,{session:t,row:r,schema:n,field:i}),e)}attach(e){return e}}},1:function(e,t){e.exports=function(e){return async function(t=null,{session:r,field:{name:n}}){if(null===t)return t;let i=new Error(`Field ${n} values must be ${e}`);if(!Array.isArray(t))throw i;try{let o=r.getSchema(e);await Promise.all(t.map(e=>o.filter(e,{session:r}))),t=t.map(e=>o.attach(e))}catch(i){throw console.error(`Caught error at nested model, ${i.stack}`),new Error(`Field ${n} must be compatible to '${e}'`)}return t}}},10:function(e,t){e.exports=function(){return async function(e,{row:t,session:r,schema:n,field:{name:i}}){let o={[i]:e},s=await r.factory(n.name,o).single();if(s&&s.id!==t.id)throw new Error(`Field ${i} must be unique`);return e}}},12:function(e,t,r){let n={};class i{static tokenize(e){if("string"!=typeof e)throw new Error("Cannot tokenize non-string filter signature");let[t,...r]=e.split(":");return[t,...r=0===(r=r.join(":")).length?[]:r.split(",")]}static get(e){let t=typeof e;if("function"===t)return e;if("string"===t&&(e=i.tokenize(e)),!Array.isArray(e))throw new Error(`Unknown filter by ${t}`);let[o,...s]=e;if(o in n==!1)try{n[o]=r(17)("./"+o)}catch(e){n[o]=null}if(!n[o]){let r="unknown";try{r=JSON.stringify(e)}catch(e){}throw new Error(`Filter ${o} not found <${t}(${r})>`)}return n[o](...s)}static put(e,t){n[e]=t}static reset(){n={}}}e.exports=i},17:function(e,t,r){var n={"./are":1,"./are.js":1,"./default":2,"./default.js":2,"./email":3,"./email.js":3,"./enum":4,"./enum.js":4,"./exists":5,"./exists.js":5,"./notEmpty":6,"./notEmpty.js":6,"./notExists":7,"./notExists.js":7,"./required":8,"./required.js":8,"./requiredIf":9,"./requiredIf.js":9,"./unique":10,"./unique.js":10};function i(e){var t=o(e);return r(t)}function o(e){var t=n[e];if(!(t+1)){var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}return t}i.keys=function(){return Object.keys(n)},i.resolve=o,e.exports=i,i.id=17},2:function(e,t){e.exports=function(e){return function(t=null){return null===t?e:t}}},21:function(e,t,r){const n=r(0);e.exports=class extends n{}},3:function(e,t){e.exports=function(){return function(e=null,{field:{name:t}}){if(null===e)return e;e=e.toLowerCase();let r=new Error(`Field ${t} must be valid email`);const n=e.split("@");if(2!==n.length)throw r;const i=n.pop();let o=n.join("@");if("gmail.com"!==i&&"googlemail.com"!==i||(o=o.replace(/\./g,"").toLowerCase()),o.length>64||i.length>256)throw r;return e}}},4:function(e,t){e.exports=function(...e){return function(t=null,{field:{name:r}}){if(null===t)return t;if(-1===e.indexOf(t))throw new Error(`Field ${r} out of enum range`);return t}}},5:function(e,t){e.exports=function(e,t="id"){return async function(r,{session:n,field:{name:i}}){if(!r)return;let o={};if(o[t]=r,!await n.factory(e,o).single())throw new Error(`Field ${i} must be exists`);return r}}},59:function(e,t,r){const n=r(21);class i{constructor({createdKey:e="created_by",updatedKey:t="updated_by",userCallback:r=(e=>e.query.session.actor)}={}){this.createdKey=e,this.updatedKey=t,this.userCallback=r}initialize(e){e.addField(new n(this.createdKey)),e.addField(new n(this.updatedKey))}async insert(e,t){let{query:r}=e;r.rows.forEach(t=>{t[this.createdKey]=t[this.updatedKey]=this.userCallback(e)}),await t()}async update(e,t){let{query:r}=e;r.sets[this.updatedKey]=this.userCallback(e),await t()}}if("undefined"!=typeof window){let e=window.norm;if(!e)throw new Error("Norm is not defined yet!");e.observers=e.observers||{},e.observers.Actorable=i}e.exports=i},6:function(e,t){e.exports=function(){return function(e,{field:{name:t}}){if(!e||Array.isArray(e)&&e.length)throw new Error(`Field ${t} must not empty`);return e}}},7:function(e,t){e.exports=function(e){return async function(t,{row:r,session:n,field:{name:i}}){let o={[i]:t},s=await n.factory(e,o).single();if(s&&s.id!==r.id)throw new Error(`Field ${i} already exists in ${e}`);return t}}},8:function(e,t){e.exports=function(){return function(e=null,{field:{name:t="unknown"}}){if(null===e||""===e)throw new Error(`Field ${t} is required`);return e}}},9:function(e,t){e.exports=function(e,t){return function(r=null,{session:n,row:i,field:{name:o="unknown"}}){if(i[e]===t&&null===r)throw new Error(`Field ${o} is required`);return r}}}});
//# sourceMappingURL=actorable.min.js.map