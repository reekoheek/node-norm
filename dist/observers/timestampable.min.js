!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=63)}({0:function(e,t,n){const r=n(11);e.exports=class{constructor(e){this.name=e,this.rawFilters=[],this.filters=[],this.attributes={}}set(e,t){return this.attributes[e]=t,this}get(e){return this.attributes[e]}filter(...e){return e.forEach(e=>{try{e=r.tokenize(e)}catch(e){}this.rawFilters.push(e),this.filters.push(r.get(e))}),this}execFilter(e,{session:t,row:n,schema:r}){"string"==typeof e&&(e=e.trim());const i=this;return this.filters.reduce(async(e,o)=>o(await e,{session:t,row:n,schema:r,field:i}),e)}attach(e){return""===e||null==e?null:e}serialize(e){return e}compare(e,t){return void 0===t&&(t=null),e===t?0:null===e?1:e>t?-1:1}indexOf(e,t){return e.indexOf(t)}}},1:function(e,t){e.exports=function(e){return async function(t=null,{session:n,field:{name:r}}){if(null===t||""===t)return null;const i=new Error(`Field ${r} values must be ${e}`);if(!Array.isArray(t))throw i;try{const o=n.getSchema(e);await Promise.all(t.map(e=>o.filter(e,{session:n}))),t=t.map(e=>o.attach(e))}catch(i){throw console.error(`Caught error at nested model, ${i.stack}`),new Error(`Field ${r} must be compatible to '${e}'`)}return t}}},10:function(e,t){e.exports=function(){return async function(e,{row:t,session:n,schema:r,field:{name:i}}){if(null===e||""===e)return null;const o={[i]:e},u=await n.factory(r.name,o).single();if(u&&u.id!==t.id)throw new Error(`Field ${i} must be unique`);return e}}},11:function(e,t,n){let r={};class i{static tokenize(e){if("string"!=typeof e)throw new Error("Cannot tokenize non-string filter signature");let[t,...n]=e.split(":");return n=0===(n=n.join(":")).length?[]:n.split(","),[t,...n]}static get(e){const t=typeof e;if("function"===t)return e;if("string"===t&&(e=i.tokenize(e)),!Array.isArray(e))throw new Error(`Unknown filter by ${t}`);const[o,...u]=e;if(o in r==!1)try{r[o]=n(13)("./"+o)}catch(e){r[o]=null}if(!r[o]){let n="unknown";try{n=JSON.stringify(e)}catch(e){}throw new Error(`Filter ${o} not found <${t}(${n})>`)}return r[o](...u)}static put(e,t){r[e]=t}static reset(){r={}}}e.exports=i},13:function(e,t,n){var r={"./are":1,"./are.js":1,"./default":2,"./default.js":2,"./email":3,"./email.js":3,"./enum":4,"./enum.js":4,"./exists":5,"./exists.js":5,"./notEmpty":6,"./notEmpty.js":6,"./notExists":7,"./notExists.js":7,"./required":8,"./required.js":8,"./requiredIf":9,"./requiredIf.js":9,"./unique":10,"./unique.js":10};function i(e){var t=o(e);return n(t)}function o(e){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=o,e.exports=i,i.id=13},2:function(e,t){e.exports=function(e){return function(t=null){return null==t||""===t?e:t}}},20:function(e,t,n){const r=n(0);e.exports=class extends r{attach(e){if(null===(e=super.attach(e)))return null;if("string"!=typeof e||isNaN(e)||(e=Number(e)),"number"==typeof e){const t=new Date;return t.setTime(e),t}const t=new Date(e);if(isNaN(t.getTime()))throw new Error("Invalid datetime value");return t}}},3:function(e,t){e.exports=function(){return function(e=null,{field:{name:t}}){if(null===e||""===e)return null;e=e.toLowerCase();const n=new Error(`Field ${t} must be valid email`),r=e.split("@");if(2!==r.length)throw n;const i=r.pop();let o=r.join("@");if("gmail.com"!==i&&"googlemail.com"!==i||(o=o.replace(/\./g,"").toLowerCase()),o.length>64||i.length>256)throw n;return e}}},4:function(e,t){e.exports=function(...e){return function(t=null,{field:{name:n}}){if(null===t||""===t)return null;if(-1===e.indexOf(t))throw new Error(`Field ${n} out of enum range`);return t}}},5:function(e,t){e.exports=function(e,t="id"){return async function(n,{session:r,field:{name:i}}){if(null===n||""===n)return null;const o={};if(o[t]=n,!await r.factory(e,o).single())throw new Error(`Field ${i} must be exists`);return n}}},6:function(e,t){e.exports=function(){return function(e,{field:{name:t}}){if(!e||Array.isArray(e)&&e.length)throw new Error(`Field ${t} must not empty`);return e}}},63:function(e,t,n){const r=n(20);class i{constructor({createdKey:e="created_time",updatedKey:t="updated_time"}={}){this.createdKey=e,this.updatedKey=t}initialize(e){e.addField(new r(this.createdKey)),e.addField(new r(this.updatedKey))}async insert({query:e},t){e.rows.forEach(e=>{e[this.createdKey]=e[this.updatedKey]=new Date}),await t()}async update({query:e},t){e.sets[this.updatedKey]=new Date,await t()}}if("undefined"!=typeof window){const e=window.norm;if(!e)throw new Error("Norm is not defined yet!");e.observers=e.observers||{},e.observers.Timestampable=i}e.exports=i},7:function(e,t){e.exports=function(e){return async function(t,{row:n,session:r,field:{name:i}}){if(null===t||""===t)return null;const o={[i]:t},u=await r.factory(e,o).single();if(u&&u.id!==n.id)throw new Error(`Field ${i} already exists in ${e}`);return t}}},8:function(e,t){e.exports=function(){return function(e=null,{field:{name:t="unknown"}}){if(null===e||""===e)throw new Error(`Field ${t} is required`);return e}}},9:function(e,t){e.exports=function(e,t){return function(n=null,{session:r,row:i,field:{name:o="unknown"}}){if(i[e]===t&&(null===n||""===n))throw new Error(`Field ${o} is required`);return n}}}});
//# sourceMappingURL=timestampable.min.js.map