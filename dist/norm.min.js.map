{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./schemas/nfield.js","webpack:///./filters/are.js","webpack:///./filters/default.js","webpack:///./filters/email.js","webpack:///./filters/enum.js","webpack:///./filters/exists.js","webpack:///./filters/notEmpty.js","webpack:///./filters/notExists.js","webpack:///./filters/required.js","webpack:///./filters/requiredIf.js","webpack:///./filters/unique.js","webpack:///./filter.js","webpack:///./connection.js","webpack:///./filters sync ^\\.\\/.*$","webpack:///./adapters/memory.js","webpack:///./node_modules/uuid/v4.js","webpack:///./node_modules/uuid/lib/rng-browser.js","webpack:///./node_modules/uuid/lib/bytesToUuid.js","webpack:///./node_modules/generic-pool/lib/Deferred.js","webpack:///./node_modules/generic-pool/lib/Deque.js","webpack:///./schemas/ndatetime.js","webpack:///./schemas/nstring.js","webpack:///./pool.js","webpack:///./node_modules/generic-pool/lib/DefaultEvictor.js","webpack:///./node_modules/generic-pool/lib/DoublyLinkedList.js","webpack:///./node_modules/generic-pool/lib/DequeIterator.js","webpack:///./node_modules/generic-pool/lib/PriorityQueue.js","webpack:///./schema.js","webpack:///./model.js","webpack:///./query.js","webpack:///./index.js","webpack:///./manager.js","webpack:///./node_modules/generic-pool/index.js","webpack:///./node_modules/generic-pool/lib/Pool.js","webpack:///./node_modules/events/events.js","webpack:///./node_modules/generic-pool/lib/factoryValidator.js","webpack:///./node_modules/generic-pool/lib/PoolOptions.js","webpack:///./node_modules/generic-pool/lib/PoolDefaults.js","webpack:///./node_modules/generic-pool/lib/ResourceRequest.js","webpack:///./node_modules/generic-pool/lib/errors.js","webpack:///./node_modules/generic-pool/lib/ResourceLoan.js","webpack:///./node_modules/generic-pool/lib/PooledResource.js","webpack:///./node_modules/generic-pool/lib/PooledResourceStateEnum.js","webpack:///./node_modules/generic-pool/lib/DoublyLinkedListIterator.js","webpack:///./node_modules/generic-pool/lib/Queue.js","webpack:///./node_modules/generic-pool/lib/utils.js","webpack:///./errors/filter.js","webpack:///./node_modules/koa-compose/index.js","webpack:///./session.js","webpack:///./node_modules/async-factory/index.js","webpack:///./schemas/index.js","webpack:///./schemas/nboolean.js","webpack:///./schemas/ndouble.js","webpack:///./schemas/ninteger.js","webpack:///./schemas/nreference.js","webpack:///./schemas/ntext.js","webpack:///./schemas/nlist.js","webpack:///./schemas/nmap.js","webpack:///./schemas/nbig.js","webpack:///./node_modules/big.js/big.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Filter","this","rawFilters","filters","attributes","forEach","filter","tokenize","err","push","session","row","schema","trim","field","reduce","async","promise","criteria","undefined","indexOf","Error","Array","isArray","schemaO","getSchema","Promise","all","map","attach","console","error","stack","defaultValue","toLowerCase","parts","split","length","domain","pop","user","join","replace","enums","factory","single","foundRow","id","expected","signature","head","rest","signatureType","fn","args","normalizedSignature","JSON","stringify","_hasTx","_begin","_commit","_rollback","webpackContext","req","webpackContextResolve","e","code","keys","resolve","Connection","uuidv4","Memory","options","super","data","query","callback","sorts","_matchCriteria","sortFields","sort","a","b","score","index","sortV","fieldScore","Math","pow","offset","slice","rows","inserted","qRow","k","getField","serialize","sets","load","affected","splice","useSkipAndLimit","count","critValue","nkey","op","rowValue","valid","subCriteria","compare","re","RegExp","match","window","norm","adapters","rng","bytesToUuid","buf","rnds","random","ii","getRandomValues","crypto","msCrypto","rnds8","Uint8Array","byteToHex","toString","substr","bth","Deferred","_state","PENDING","_resolve","_reject","_promise","reject","reason","REJECTED","FULFILLED","DoublyLinkedList","DequeIterator","_list","node","remove","element","createNode","insertBeginning","insertEnd","tail","iterator","NField","isNaN","Number","date","Date","setTime","getTime","genericPool","Schema","poolNextId","config","adapter","schemas","min","max","colOptions","putSchema","Adapter","writable","configurable","createPool","end","fields","observers","modelClass","connection","_pool","acquire","release","drain","clear","pooledResource","availableObjectsCount","idleTime","now","lastIdleTime","softIdleTimeoutMillis","idleTimeoutMillis","prev","next","insertBefore","insertAfter","newNode","DoublyLinkedListIterator","result","Queue","size","_size","_slots","_length","slots","obj","priority","sl","shift","FilterError","Model","compose","observer","addObserver","find","f","initialize","partial","ctx","_observerRunner","units","add","execFilter","empty","Query","parseSchema","set","observe","_delete","delete","_save","insert","update","drop","truncate","limit","Manager","Pool","lib","Session","ctr","connections","pools","main","putPool","pool","openSession","close","dispose","manager","Deque","PriorityQueue","DefaultEvictor","EventEmitter","factoryValidator","PoolOptions","ResourceRequest","ResourceLoan","PooledResource","reflector","FACTORY_CREATE_ERROR","FACTORY_DESTROY_ERROR","Evictor","_config","_Promise","_factory","_draining","_started","_waitingClientsQueue","priorityRange","_factoryCreateOperations","Set","_factoryDestroyOperations","_availableObjects","_testOnBorrowResources","_testOnReturnResources","_validationOperations","_allObjects","_resourceLoans","Map","_evictionIterator","_evictor","_scheduledEviction","autostart","start","invalidate","destroyPromise","destroy","wrappedDestroyPromise","_trackOperation","catch","emit","_ensureMinimum","test","validationPromise","validate","wrappedValidationPromise","then","isValid","_destroy","_dispense","_dispatchPooledResourceToNextWaitingClient","numWaitingClients","resourceShortfall","_potentiallyAllocableResourceCount","actualNumberOfResourcesToCreate","spareResourceCapacity","_createResource","testOnBorrow","desiredNumberOfResourcesToMoveIntoTest","actualNumberOfResourcesToMoveIntoTest","_testOnBorrow","actualNumberOfResourcesToDispatch","_dispatchResource","clientResourceRequest","dequeue","state","_addPooledResourceToAvailableObjects","loan","allocate","operation","v","factoryPromise","wrappedFactoryPromise","resource","minShortfall","_count","testsToRun","numTestsPerEvictionRun","evictionConfig","testsHaveRun","iterationResult","done","reset","shouldEvict","evict","evictionRunIntervalMillis","setTimeout","_evict","_scheduleEvictorRun","clearTimeout","maxWaitingClients","resourceRequest","acquireTimeoutMillis","enqueue","has","deallocate","idle","fifo","unshift","__allResourceRequestsSettled","__allResourcesReturned","_descheduleEvictorRun","ps","from","values","reflectedCreatePromises","reflectedDestroyPromises","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","init","_events","_eventsCount","_maxListeners","defaultMaxListeners","$getMaxListeners","that","_addListener","type","listener","prepend","events","existing","warning","TypeError","newListener","warned","w","String","emitter","warn","_onceWrap","fired","wrapFn","wrapped","arguments","removeListener","_listeners","unwrap","evlistener","arr","ret","unwrapListeners","arrayClone","listenerCount","copy","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","er","message","context","handler","len","listeners","addListener","on","prependListener","once","prependOnceListener","list","position","originalListener","spliceOne","off","removeAllListeners","rawListeners","eventNames","PoolDefaults","opts","poolDefaults","testOnReturn","parseInt","errors","ttl","_creationTimestamp","_timeout","delay","age","removeTimeout","_fireTimeout","TimeoutError","ExtendableError","constructor","captureStackTrace","PooledResourceStateEnum","creationTime","lastReturnTime","lastBorrowTime","IDLE","ALLOCATED","INVALID","VALIDATION","RETURNING","doublyLinkedList","reverse","_direction","_startPosition","_cursor","_done","_isCursorDetached","_advanceCursor","_createTimeoutRejectionHandler","noop","status","children","child","middleware","dispatch","connectionFactory","sessionNextId","assign","getPool","singleton","begin","rollback","commit","Space","locks","spaces","space","fetch","NBoolean","NDatetime","NDouble","NInteger","NReference","NString","NText","NList","NMap","NBig","Boolean","parseFloat","to","childField","parse","criteriaKeys","valueKeys","includes","Big","cmp","toJSON","GLOBAL","DP","RM","MAX_DP","NE","PE","NAME","INVALID_DP","INVALID_RM","P","UNDEFINED","NUMERIC","round","x","dp","rm","more","xc","z","charAt","abs","y","isneg","yc","j","div","bl","bt","ri","bz","ai","al","rl","q","qc","qi","eq","gt","gte","lt","lte","minus","sub","xlty","plus","xe","ye","mod","ygtx","times","one","sqrt","half","toExponential","mul","toFixed","toPrecision","sd","valueOf","_Big_","nl","search","substring","version"],"mappings":"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","file":"norm.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 30);\n","const Filter = require('../filter');\n\nclass NField {\n  constructor (name) {\n    this.name = name;\n    this.rawFilters = [];\n    this.filters = [];\n    this.attributes = {};\n  }\n\n  set (key, value) {\n    this.attributes[key] = value;\n    return this;\n  }\n\n  get (key) {\n    return this.attributes[key];\n  }\n\n  filter (...filters) {\n    filters.forEach(filter => {\n      try {\n        filter = Filter.tokenize(filter);\n      } catch (err) {\n        // noop\n      }\n\n      this.rawFilters.push(filter);\n      this.filters.push(Filter.get(filter));\n    });\n\n    return this;\n  }\n\n  execFilter (value, { session, row, schema }) {\n    // when value is string, trim first before filtering\n    if (typeof value === 'string') {\n      value = value.trim();\n    }\n\n    const field = this;\n    return this.filters.reduce(\n      async (promise, filter) => filter(await promise, { session, row, schema, field }),\n      value\n    );\n  }\n\n  attach (value) {\n    if (value === '' || value === undefined || value === null) {\n      return null;\n    }\n\n    return value;\n  }\n\n  serialize (value) {\n    return value;\n  }\n\n  compare (criteria, value) {\n    if (value === undefined) {\n      value = null;\n    }\n\n    if (criteria === value) {\n      return 0;\n    }\n\n    if (criteria === null) {\n      return 1;\n    }\n\n    if (criteria > value) {\n      return -1;\n    }\n\n    return 1;\n  }\n\n  indexOf (criteria, value) {\n    return criteria.indexOf(value);\n  }\n}\n\nmodule.exports = NField;\n","module.exports = function (schema) {\n  return async function (value = null, { session, field: { name } }) {\n    if (value === null || value === '') {\n      return null;\n    }\n\n    const err = new Error(`Field ${name} values must be ${schema}`);\n\n    if (!Array.isArray(value)) {\n      throw err;\n    }\n\n    try {\n      const schemaO = session.getSchema(schema);\n      await Promise.all(value.map(row => schemaO.filter(row, { session })));\n      value = value.map(row => schemaO.attach(row));\n    } catch (err) {\n      console.error(`Caught error at nested model, ${err.stack}`);\n      throw new Error(`Field ${name} must be compatible to '${schema}'`);\n    }\n\n    return value;\n  };\n};\n","module.exports = function def (defaultValue) {\n  return function (value = null) {\n    if (value === null || value === undefined || value === '') {\n      return defaultValue;\n    }\n\n    return value;\n  };\n};\n","module.exports = function email () {\n  return function (value = null, { field: { name } }) {\n    if (value === null || value === '') {\n      return null;\n    }\n\n    value = value.toLowerCase();\n\n    const err = new Error(`Field ${name} must be valid email`);\n\n    const parts = value.split('@');\n\n    if (parts.length !== 2) {\n      throw err;\n    }\n\n    const domain = parts.pop();\n    let user = parts.join('@');\n\n    if (domain === 'gmail.com' || domain === 'googlemail.com') {\n      user = user.replace(/\\./g, '').toLowerCase();\n    }\n\n    if (user.length > 64 || domain.length > 256) {\n      throw err;\n    }\n\n    return value;\n  };\n};\n","module.exports = function (...enums) {\n  return function (value = null, { field: { name } }) {\n    if (value === null || value === '') {\n      return null;\n    }\n\n    if (enums.indexOf(value) === -1) {\n      throw new Error(`Field ${name} out of enum range`);\n    }\n\n    return value;\n  };\n};\n","module.exports = function exists (schema, key = 'id') {\n  return async function (value, { session, field: { name } }) {\n    if (value === null || value === '') {\n      return null;\n    }\n\n    const criteria = {};\n    criteria[key] = value;\n\n    if (!(await session.factory(schema, criteria).single())) {\n      throw new Error(`Field ${name} must be exists`);\n    }\n\n    return value;\n  };\n};\n","module.exports = function notEmpty () {\n  return function (value, { field: { name } }) {\n    if (!value || (Array.isArray(value) && value.length)) {\n      throw new Error(`Field ${name} must not empty`);\n    }\n\n    return value;\n  };\n};\n","module.exports = function notExists (schema) {\n  return async function (value, { row, session, field: { name } }) {\n    if (value === null || value === '') {\n      return null;\n    }\n\n    const criteria = { [name]: value };\n    const foundRow = await session.factory(schema, criteria).single();\n    if (foundRow && foundRow.id !== row.id) {\n      throw new Error(`Field ${name} already exists in ${schema}`);\n    }\n\n    return value;\n  };\n};\n","module.exports = function required () {\n  return function (value = null, { field: { name = 'unknown' } }) {\n    if (value === null || value === '') {\n      throw new Error(`Field ${name} is required`);\n    }\n\n    return value;\n  };\n};\n","module.exports = function requiredIf (key, expected) {\n  return function (value = null, { session, row, field: { name = 'unknown' } }) {\n    if (row[key] === expected && (value === null || value === '')) {\n      throw new Error(`Field ${name} is required`);\n    }\n\n    return value;\n  };\n};\n","module.exports = function unique () {\n  return async function (value, { row, session, schema, field: { name } }) {\n    if (value === null || value === '') {\n      return null;\n    }\n\n    const criteria = { [name]: value };\n    const foundRow = await session.factory(schema.name, criteria).single();\n    if (foundRow && foundRow.id !== row.id) {\n      throw new Error(`Field ${name} must be unique`);\n    }\n\n    return value;\n  };\n};\n","let filters = {};\n\nclass Filter {\n  static tokenize (signature) {\n    if (typeof signature !== 'string') {\n      throw new Error('Cannot tokenize non-string filter signature');\n    }\n\n    let [head, ...rest] = signature.split(':');\n    rest = rest.join(':');\n    rest = rest.length === 0 ? [] : rest.split(',');\n\n    return [head, ...rest];\n  }\n\n  static get (signature) {\n    const signatureType = typeof signature;\n\n    if (signatureType === 'function') {\n      return signature;\n    }\n\n    if (signatureType === 'string') {\n      signature = Filter.tokenize(signature);\n    }\n\n    if (!Array.isArray(signature)) {\n      throw new Error(`Unknown filter by ${signatureType}`);\n    }\n\n    const [fn, ...args] = signature;\n\n    if (fn in filters === false) {\n      try {\n        filters[fn] = require('./filters/' + fn);\n      } catch (err) {\n        filters[fn] = null;\n      }\n    }\n\n    if (!filters[fn]) {\n      let normalizedSignature = 'unknown';\n      try {\n        normalizedSignature = JSON.stringify(signature);\n      } catch (err) {\n        // noop\n      }\n      throw new Error(`Filter ${fn} not found <${signatureType}(${normalizedSignature})>`);\n    }\n\n    return filters[fn](...args);\n  }\n\n  static put (name, filter) {\n    filters[name] = filter;\n  }\n\n  static reset () {\n    filters = {};\n  }\n}\n\nmodule.exports = Filter;\n","class Connection {\n  constructor ({ name }) {\n    this.name = name;\n    this._hasTx = false;\n  }\n\n  async begin () {\n    if (this._hasTx) {\n      return;\n    }\n\n    await this._begin();\n\n    this._hasTx = true;\n  }\n\n  async commit () {\n    if (!this._hasTx) {\n      return;\n    }\n\n    await this._commit();\n    this._hasTx = false;\n  }\n\n  async rollback () {\n    if (!this._hasTx) {\n      return;\n    }\n\n    await this._rollback();\n    this._hasTx = false;\n  }\n\n  _begin () {\n    // do nothing\n  }\n\n  _commit () {\n    // do nothing\n  }\n\n  _rollback () {\n    // do nothing\n  }\n}\n\nmodule.exports = Connection;\n","var map = {\n\t\"./are\": 1,\n\t\"./are.js\": 1,\n\t\"./default\": 2,\n\t\"./default.js\": 2,\n\t\"./email\": 3,\n\t\"./email.js\": 3,\n\t\"./enum\": 4,\n\t\"./enum.js\": 4,\n\t\"./exists\": 5,\n\t\"./exists.js\": 5,\n\t\"./notEmpty\": 6,\n\t\"./notEmpty.js\": 6,\n\t\"./notExists\": 7,\n\t\"./notExists.js\": 7,\n\t\"./required\": 8,\n\t\"./required.js\": 8,\n\t\"./requiredIf\": 9,\n\t\"./requiredIf.js\": 9,\n\t\"./unique\": 10,\n\t\"./unique.js\": 10\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 13;","const Connection = require('../connection');\nconst uuidv4 = require('uuid/v4');\n\nclass Memory extends Connection {\n  constructor (options) {\n    super(options);\n\n    this.data = options.data || {};\n  }\n\n  load (query, callback = () => {}) {\n    let data = this.data[query.schema.name] || [];\n\n    const { criteria, sorts } = query;\n\n    // if (criteria && typeof criteria.id !== 'undefined') {\n    //   const row = data.find(row => row.id === criteria.id);\n    //   data = row ? [ row ] : [];\n    // } else {\n    data = data.filter(row => this._matchCriteria(criteria, row, query.schema));\n\n    if (sorts) {\n      const sortFields = Object.keys(sorts);\n\n      data = data.sort((a, b) => {\n        let score = 0;\n        sortFields.forEach((field, index) => {\n          const sortV = sorts[field];\n          const fieldScore = Math.pow(2, sortFields.length - index - 1) * sortV;\n          if (a[field] < b[field]) {\n            score -= fieldScore;\n          } else if (a[field] > b[field]) {\n            score += fieldScore;\n          }\n        });\n        return score;\n      });\n    }\n\n    if (query.offset < 0) {\n      return data;\n    } else if (query.length < 0) {\n      data = data.slice(query.offset);\n    } else {\n      data = data.slice(query.offset, query.offset + query.length);\n    }\n    // }\n\n    return data.map(row => {\n      callback(row);\n      return row;\n    });\n  }\n\n  insert (query, callback = () => {}) {\n    const data = this.data[query.schema.name] = this.data[query.schema.name] || [];\n\n    return query.rows.reduce((inserted, qRow) => {\n      const row = { id: uuidv4() };\n      for (const k in qRow) { // eslint-disable-line no-unused-vars\n        row[k] = query.schema.getField(k).serialize(qRow[k]);\n      }\n      data.push(row);\n      callback(row);\n      inserted++;\n      return inserted;\n    }, 0);\n  }\n\n  update (query) {\n    const keys = Object.keys(query.sets);\n    return this.load(query).reduce((affected, row) => {\n      const fieldChanges = keys.filter(key => {\n        if (row[key] === query.sets[key]) {\n          return false;\n        }\n\n        row[key] = query.schema.getField(key).serialize(query.sets[key]);\n        return true;\n      });\n      if (fieldChanges.length) {\n        affected++;\n      }\n      return affected;\n    }, 0);\n  }\n\n  drop (query) {\n    delete this.data[query.schema.name];\n  }\n\n  truncate (query) {\n    this.data[query.schema.name] = [];\n  }\n\n  delete (query) {\n    const data = this.data[query.schema.name] = this.data[query.schema.name] || [];\n\n    this.load(query).forEach(row => {\n      const key = data.indexOf(row);\n      if (key >= 0) {\n        data.splice(key, 1);\n      }\n    });\n  }\n\n  async count (query, useSkipAndLimit) {\n    const { length, offset } = query;\n\n    if (!useSkipAndLimit) {\n      query.offset = 0;\n      query.length = -1;\n    }\n\n    let count = 0;\n\n    await this.load(query, () => count++);\n\n    query.offset = offset; // eslint-disable-line require-atomic-updates\n    query.length = length; // eslint-disable-line require-atomic-updates\n\n    return count;\n  }\n\n  _matchCriteria (criteria, row, schema) {\n    if (!criteria) {\n      return true;\n    }\n\n    for (const key in criteria) { // eslint-disable-line no-unused-vars\n      const critValue = criteria[key];\n      const [nkey, op = 'eq'] = key.split('!');\n      const field = schema.getField(nkey);\n      const rowValue = row[nkey];\n      switch (op) {\n        case 'or': {\n          let valid = false;\n          for (const subCriteria of critValue) { // eslint-disable-line no-unused-vars\n            const match = this._matchCriteria(subCriteria, row, schema);\n            if (match) {\n              valid = true;\n              break;\n            }\n          }\n          if (!valid) {\n            return false;\n          }\n          break;\n        }\n        case 'and':\n          for (const subCriteria of critValue) { // eslint-disable-line no-unused-vars\n            if (!this._matchCriteria(subCriteria, row, schema)) {\n              return false;\n            }\n          }\n          break;\n        case 'eq':\n          if (field.compare(critValue, rowValue) !== 0) {\n            return false;\n          }\n          break;\n        case 'ne':\n          if (field.compare(critValue, rowValue) === 0) {\n            return false;\n          }\n          break;\n        case 'gt': {\n          if (field.compare(critValue, rowValue) <= 0) {\n            return false;\n          }\n          break;\n        }\n        case 'gte':\n          if (field.compare(critValue, rowValue) < 0) {\n            return false;\n          }\n          break;\n        case 'lt':\n          if (field.compare(critValue, rowValue) >= 0) {\n            return false;\n          }\n          break;\n        case 'lte':\n          if (field.compare(critValue, rowValue) > 0) {\n            return false;\n          }\n          break;\n        case 'in':\n          if (field.indexOf(critValue, rowValue) === -1) {\n            return false;\n          }\n          break;\n        case 'nin':\n          if (field.indexOf(critValue, rowValue) !== -1) {\n            return false;\n          }\n          break;\n        case 'like': {\n          const re = new RegExp(critValue);\n          if (!rowValue.match(re)) {\n            return false;\n          }\n          break;\n        }\n        case 'regex':\n          if (!rowValue.match(critValue)) {\n            return false;\n          }\n          break;\n        case 'where':\n          if (!critValue(rowValue, row)) {\n            return false;\n          }\n          break;\n        default:\n          throw new Error(`Operator '${op}' is not implemented yet!`);\n      }\n    }\n\n    return true;\n  }\n}\n\nif (typeof window !== 'undefined') {\n  const norm = window.norm;\n  if (!norm) {\n    throw new Error('Norm is not defined yet!');\n  }\n\n  norm.adapters = norm.adapters || {};\n  norm.adapters.Memory = Memory;\n}\n\nmodule.exports = Memory;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]], \n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]]]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","\"use strict\";\n\n/**\n * This is apparently a bit like a Jquery deferred, hence the name\n */\n\nclass Deferred {\n  constructor(Promise) {\n    this._state = Deferred.PENDING;\n    this._resolve = undefined;\n    this._reject = undefined;\n\n    this._promise = new Promise((resolve, reject) => {\n      this._resolve = resolve;\n      this._reject = reject;\n    });\n  }\n\n  get state() {\n    return this._state;\n  }\n\n  get promise() {\n    return this._promise;\n  }\n\n  reject(reason) {\n    if (this._state !== Deferred.PENDING) {\n      return;\n    }\n    this._state = Deferred.REJECTED;\n    this._reject(reason);\n  }\n\n  resolve(value) {\n    if (this._state !== Deferred.PENDING) {\n      return;\n    }\n    this._state = Deferred.FULFILLED;\n    this._resolve(value);\n  }\n}\n\n// TODO: should these really live here? or be a seperate 'state' enum\nDeferred.PENDING = \"PENDING\";\nDeferred.FULFILLED = \"FULFILLED\";\nDeferred.REJECTED = \"REJECTED\";\n\nmodule.exports = Deferred;\n","\"use strict\";\n\nconst DoublyLinkedList = require(\"./DoublyLinkedList\");\nconst DequeIterator = require(\"./DequeIterator\");\n/**\n * DoublyLinkedList backed double ended queue\n * implements just enough to keep the Pool\n */\nclass Deque {\n  constructor() {\n    this._list = new DoublyLinkedList();\n  }\n\n  /**\n   * removes and returns the first element from the queue\n   * @return {any} [description]\n   */\n  shift() {\n    if (this.length === 0) {\n      return undefined;\n    }\n\n    const node = this._list.head;\n    this._list.remove(node);\n\n    return node.data;\n  }\n\n  /**\n   * adds one elemts to the beginning of the queue\n   * @param  {any} element [description]\n   * @return {any}         [description]\n   */\n  unshift(element) {\n    const node = DoublyLinkedList.createNode(element);\n\n    this._list.insertBeginning(node);\n  }\n\n  /**\n   * adds one to the end of the queue\n   * @param  {any} element [description]\n   * @return {any}         [description]\n   */\n  push(element) {\n    const node = DoublyLinkedList.createNode(element);\n\n    this._list.insertEnd(node);\n  }\n\n  /**\n   * removes and returns the last element from the queue\n   */\n  pop() {\n    if (this.length === 0) {\n      return undefined;\n    }\n\n    const node = this._list.tail;\n    this._list.remove(node);\n\n    return node.data;\n  }\n\n  [Symbol.iterator]() {\n    return new DequeIterator(this._list);\n  }\n\n  iterator() {\n    return new DequeIterator(this._list);\n  }\n\n  reverseIterator() {\n    return new DequeIterator(this._list, true);\n  }\n\n  /**\n   * get a reference to the item at the head of the queue\n   * @return {any} [description]\n   */\n  get head() {\n    if (this.length === 0) {\n      return undefined;\n    }\n    const node = this._list.head;\n    return node.data;\n  }\n\n  /**\n   * get a reference to the item at the tail of the queue\n   * @return {any} [description]\n   */\n  get tail() {\n    if (this.length === 0) {\n      return undefined;\n    }\n    const node = this._list.tail;\n    return node.data;\n  }\n\n  get length() {\n    return this._list.length;\n  }\n}\n\nmodule.exports = Deque;\n","const NField = require('./nfield');\n\nmodule.exports = class NDatetime extends NField {\n  attach (value) {\n    value = super.attach(value);\n\n    if (value === null) {\n      return null;\n    }\n\n    if (typeof value === 'string' && !isNaN(value)) {\n      value = Number(value);\n    }\n\n    if (typeof value === 'number') {\n      const date = new Date();\n      date.setTime(value);\n      return date;\n    }\n\n    const date = new Date(value);\n    if (isNaN(date.getTime())) {\n      throw new Error('Invalid datetime value');\n    }\n\n    return date;\n  }\n};\n","const NField = require('./nfield');\n\nmodule.exports = class NString extends NField {\n\n};\n","const genericPool = require('generic-pool');\nconst Schema = require('./schema');\n\nlet poolNextId = 0;\n\nclass Pool {\n  constructor (config) {\n    const { name, adapter = require('./adapters/memory'), schemas = [], min = 1, max = 2 } = config;\n\n    this.name = name || `pool-${poolNextId++}`;\n    this.schemas = {};\n\n    schemas.forEach(colOptions => this.putSchema(colOptions));\n\n    const Adapter = adapter;\n\n    Object.defineProperty(this, '_pool', {\n      enumerable: false,\n      writable: false,\n      configurable: false,\n      value: genericPool.createPool({\n        create () {\n          return new Adapter(config);\n        },\n        async destroy (adapter) {\n          if (adapter.end) {\n            await adapter.end();\n          }\n        },\n      }, { min, max }),\n    });\n  }\n\n  putSchema ({ name, fields, observers, modelClass }) {\n    const connection = this.name;\n    this.schemas[name] = new Schema({ connection, name, fields, observers, modelClass });\n    return this;\n  }\n\n  /**\n   * Getter schema\n   *\n   * @param {string} name\n   */\n  getSchema (name) {\n    if (!this.schemas[name]) {\n      this.putSchema({ name });\n    }\n    return this.schemas[name];\n  }\n\n  acquire (...args) {\n    return this._pool.acquire(...args);\n  }\n\n  release (...args) {\n    return this._pool.release(...args);\n  }\n\n  drain (...args) {\n    return this._pool.drain(...args);\n  }\n\n  clear (...args) {\n    return this._pool.clear(...args);\n  }\n}\n\nmodule.exports = Pool;\n","\"use strict\";\n\nclass DefaultEvictor {\n  evict(config, pooledResource, availableObjectsCount) {\n    const idleTime = Date.now() - pooledResource.lastIdleTime;\n\n    if (\n      config.softIdleTimeoutMillis > 0 &&\n      config.softIdleTimeoutMillis < idleTime &&\n      config.min < availableObjectsCount\n    ) {\n      return true;\n    }\n\n    if (config.idleTimeoutMillis < idleTime) {\n      return true;\n    }\n\n    return false;\n  }\n}\n\nmodule.exports = DefaultEvictor;\n","\"use strict\";\n\n/**\n * A Doubly Linked List, because there aren't enough in the world...\n * this is pretty much a direct JS port of the one wikipedia\n * https://en.wikipedia.org/wiki/Doubly_linked_list\n *\n * For most usage 'insertBeginning' and 'insertEnd' should be enough\n *\n * nodes are expected to something like a POJSO like\n * {\n *   prev: null,\n *   next: null,\n *   something: 'whatever you like'\n * }\n */\nclass DoublyLinkedList {\n  constructor() {\n    this.head = null;\n    this.tail = null;\n    this.length = 0;\n  }\n\n  insertBeginning(node) {\n    if (this.head === null) {\n      this.head = node;\n      this.tail = node;\n      node.prev = null;\n      node.next = null;\n      this.length++;\n    } else {\n      this.insertBefore(this.head, node);\n    }\n  }\n\n  insertEnd(node) {\n    if (this.tail === null) {\n      this.insertBeginning(node);\n    } else {\n      this.insertAfter(this.tail, node);\n    }\n  }\n\n  insertAfter(node, newNode) {\n    newNode.prev = node;\n    newNode.next = node.next;\n    if (node.next === null) {\n      this.tail = newNode;\n    } else {\n      node.next.prev = newNode;\n    }\n    node.next = newNode;\n    this.length++;\n  }\n\n  insertBefore(node, newNode) {\n    newNode.prev = node.prev;\n    newNode.next = node;\n    if (node.prev === null) {\n      this.head = newNode;\n    } else {\n      node.prev.next = newNode;\n    }\n    node.prev = newNode;\n    this.length++;\n  }\n\n  remove(node) {\n    if (node.prev === null) {\n      this.head = node.next;\n    } else {\n      node.prev.next = node.next;\n    }\n    if (node.next === null) {\n      this.tail = node.prev;\n    } else {\n      node.next.prev = node.prev;\n    }\n    node.prev = null;\n    node.next = null;\n    this.length--;\n  }\n\n  // FIXME: this should not live here and has become a dumping ground...\n  static createNode(data) {\n    return {\n      prev: null,\n      next: null,\n      data: data\n    };\n  }\n}\n\nmodule.exports = DoublyLinkedList;\n","\"use strict\";\n\nconst DoublyLinkedListIterator = require(\"./DoublyLinkedListIterator\");\n/**\n * Thin wrapper around an underlying DDL iterator\n */\nclass DequeIterator extends DoublyLinkedListIterator {\n  next() {\n    const result = super.next();\n\n    // unwrap the node...\n    if (result.value) {\n      result.value = result.value.data;\n    }\n\n    return result;\n  }\n}\n\nmodule.exports = DequeIterator;\n","\"use strict\";\n\nconst Queue = require(\"./Queue\");\n\n/**\n * @class\n * @private\n */\nclass PriorityQueue {\n  constructor(size) {\n    this._size = Math.max(+size | 0, 1);\n    /** @type {Queue[]} */\n    this._slots = [];\n    // initialize arrays to hold queue elements\n    for (let i = 0; i < this._size; i++) {\n      this._slots.push(new Queue());\n    }\n  }\n\n  get length() {\n    let _length = 0;\n    for (let i = 0, slots = this._slots.length; i < slots; i++) {\n      _length += this._slots[i].length;\n    }\n    return _length;\n  }\n\n  enqueue(obj, priority) {\n    // Convert to integer with a default value of 0.\n    priority = (priority && +priority | 0) || 0;\n\n    if (priority) {\n      if (priority < 0 || priority >= this._size) {\n        priority = this._size - 1;\n        // put obj at the end of the line\n      }\n    }\n    this._slots[priority].push(obj);\n  }\n\n  dequeue() {\n    for (let i = 0, sl = this._slots.length; i < sl; i += 1) {\n      if (this._slots[i].length) {\n        return this._slots[i].shift();\n      }\n    }\n    return;\n  }\n\n  get head() {\n    for (let i = 0, sl = this._slots.length; i < sl; i += 1) {\n      if (this._slots[i].length > 0) {\n        return this._slots[i].head;\n      }\n    }\n    return;\n  }\n\n  get tail() {\n    for (let i = this._slots.length - 1; i >= 0; i--) {\n      if (this._slots[i].length > 0) {\n        return this._slots[i].tail;\n      }\n    }\n    return;\n  }\n}\n\nmodule.exports = PriorityQueue;\n","const FilterError = require('./errors/filter');\nconst Model = require('./model');\nconst NField = require('./schemas/nfield');\nconst compose = require('koa-compose');\n\nclass Schema {\n  constructor ({ name, fields = [], observers = [], modelClass = Model }) {\n    if (!name) {\n      throw new Error('Schema name is required');\n    }\n\n    this.name = name;\n    this.fields = fields;\n    this.observers = [];\n    this.modelClass = modelClass;\n    this.attributes = {};\n\n    observers.forEach(observer => this.addObserver(observer));\n  }\n\n  set (key, value) {\n    this.attributes[key] = value;\n    return this;\n  }\n\n  get (key) {\n    return this.attributes[key];\n  }\n\n  getField (name) {\n    return this.fields.find(f => f.name === name) || new NField(name);\n  }\n\n  addField (field) {\n    const existingField = this.fields.find(f => f.name === field.name);\n    if (existingField) {\n      return;\n    }\n\n    this.fields.push(field);\n  }\n\n  addObserver (observer) {\n    if ('initialize' in observer) {\n      observer.initialize(this);\n    }\n    this.observers.push(observer);\n  }\n\n  attach (row, partial = false) {\n    const Model = this.modelClass;\n\n    this.fields.forEach(field => {\n      switch (row[field.name]) {\n        case undefined:\n          if (!partial) {\n            row[field.name] = null;\n          }\n          break;\n        case null:\n          row[field.name] = null;\n          break;\n        default:\n          row[field.name] = field.attach(row[field.name]);\n      }\n    });\n\n    return new Model(row);\n  }\n\n  observe (ctx, next) {\n    if (!this._observerRunner) {\n      const units = this.observers.map(observer => {\n        return (ctx, next) => {\n          if (typeof observer[ctx.query.mode] !== 'function') {\n            return next();\n          }\n          return observer[ctx.query.mode](ctx, next);\n        };\n      });\n\n      this._observerRunner = compose(units);\n    }\n\n    return this._observerRunner(ctx, next);\n  }\n\n  async filter (row, { session, partial = false }) {\n    const error = new FilterError();\n\n    if (!row) {\n      error.add(new Error('Cannot filter empty row'));\n      throw error;\n    }\n\n    await Promise.all(this.fields.map(async field => {\n      try {\n        if (partial && row[field.name] === undefined) {\n          return;\n        }\n\n        row[field.name] = await field.execFilter(row[field.name], { session, row, schema: this }); // eslint-disable-line require-atomic-updates\n      } catch (err) {\n        err.field = field;\n        error.add(err);\n      }\n    }));\n\n    if (!error.empty()) {\n      throw error;\n    }\n\n    return row;\n  }\n}\n\nmodule.exports = Schema;\n","class Model {\n  constructor (row) {\n    for (const key in row) { // eslint-disable-line no-unused-vars\n      if (!Object.prototype.hasOwnProperty.call(row, key) || row[key] === undefined) {\n        continue;\n      }\n\n      this[key] = row[key];\n    }\n  }\n}\n\nmodule.exports = Model;\n","class Query {\n  constructor (options) {\n    if (options instanceof Query) {\n      this.session = options.session;\n      this.connection = options.connection;\n      this.schema = options.schema;\n      this.find(options.criteria);\n\n      this.length = options.length;\n      this.offset = options.offset;\n      this.sorts = options.sorts;\n\n      return;\n    }\n\n    const { session, schema, criteria } = options;\n\n    this.session = session;\n\n    [this.connection, this.schema] = this.session.parseSchema(schema);\n\n    this.find(criteria);\n\n    this.rows = [];\n    this.sets = {};\n    this.length = -1;\n    this.offset = 0;\n    this.sorts = undefined;\n  }\n\n  clone () {\n    return new Query(this);\n  }\n\n  find (criteria = {}) {\n    this.criteria = typeof criteria === 'object' ? criteria : { id: criteria };\n\n    return this;\n  }\n\n  insert (row) {\n    this.mode = 'insert';\n    this.rows.push(this.schema.attach(row));\n\n    return this;\n  }\n\n  sort (sorts) {\n    this.sorts = sorts;\n\n    return this;\n  }\n\n  limit (length) {\n    this.length = length;\n\n    return this;\n  }\n\n  skip (offset) {\n    this.offset = offset;\n\n    return this;\n  }\n\n  set (set) {\n    this.mode = 'update';\n    this.sets = this.schema.attach(set, true);\n\n    return this;\n  }\n\n  async delete ({ observer = true } = {}) {\n    this.mode = 'delete';\n\n    const ctx = { query: this };\n\n    if (observer) {\n      await this.schema.observe(ctx, ctx => this._delete(ctx));\n    } else {\n      await this._delete(ctx);\n    }\n\n    return ctx.result;\n  }\n\n  async _delete () {\n    const connection = await this.session.acquire(this.connection);\n    const result = await connection.delete(this);\n    return result;\n  }\n\n  async save ({ filter = true, observer = true } = {}) {\n    const ctx = { query: this, filter };\n\n    if (observer) {\n      await this.schema.observe(ctx, ctx => this._save(ctx));\n    } else {\n      await this._save(ctx);\n    }\n\n    return this;\n  }\n\n  async _save (ctx) {\n    const connection = await this.session.acquire(this.connection);\n    const { session } = this;\n    const { filter } = ctx;\n\n    if (this.rows.length) {\n      if (filter) {\n        await Promise.all(this.rows.map(row => this.schema.filter(row, { session })));\n      }\n\n      const rows = [];\n      this.affected = await connection.insert(this, row => rows.push(this.schema.attach(row)));\n      this.rows = rows;\n    } else {\n      if (filter) {\n        const partial = true;\n        await this.schema.filter(this.sets, { session, partial });\n      }\n\n      if (Object.keys(this.sets).length === 0) {\n        throw new Error('Neither insert and update to save');\n      }\n\n      this.affected = await connection.update(this);\n    }\n  }\n\n  async drop () {\n    const connection = await this.session.acquire(this.connection);\n    const result = await connection.drop(this);\n    return result;\n  }\n\n  async truncate () {\n    const connection = await this.session.acquire(this.connection);\n    const result = await connection.truncate(this);\n    return result;\n  }\n\n  async all () {\n    const rows = [];\n    const connection = await this.session.acquire(this.connection);\n    await connection.load(this, row => rows.push(this.schema.attach(row)));\n    return rows;\n  }\n\n  async count (useSkipAndLimit = false) {\n    const connection = await this.session.acquire(this.connection);\n    if (typeof connection.count !== 'function') {\n      throw new Error('Connection does not implement method count');\n    }\n    return connection.count(this, useSkipAndLimit);\n  }\n\n  async single () {\n    const [row] = await this.limit(1).all();\n    return row;\n  }\n\n  getInsertedRows () {\n    return this.rows;\n  }\n}\n\nmodule.exports = Query;\n","const Manager = require('./manager');\nconst Filter = require('./filter');\nconst Connection = require('./connection');\nconst Pool = require('./pool');\nconst Model = require('./model');\nconst Schema = require('./schema');\nconst schemas = require('./schemas');\nconst Query = require('./query');\n\nconst lib = {\n  Manager,\n  Connection,\n  Model,\n  Pool,\n  Query,\n  Filter,\n  Schema,\n  schemas,\n};\n\nif (typeof window !== 'undefined') {\n  window.norm = lib;\n}\n\nmodule.exports = lib;\n","const Pool = require('./pool');\nconst Session = require('./session');\n\nclass Manager {\n  static adapter (ctr) {\n    if (typeof ctr === 'function') {\n      return ctr;\n    }\n\n    throw new Error('Adapter must be a constructor');\n  }\n\n  constructor ({ connections = [] } = {}) {\n    this.pools = {};\n    this.main = '';\n\n    connections.forEach(connection => this.putPool(connection));\n  }\n\n  putPool (config) {\n    // resolve adapter first before creating\n    config.adapter = Manager.adapter(config.adapter);\n\n    const pool = new Pool(config);\n    this.pools[pool.name] = pool;\n    this.main = config.main ? pool.name : (this.main || pool.name);\n\n    return this;\n  }\n\n  /**\n   * Getter pool\n   *\n   * @param {string} name\n   * @returns {Pool}\n   */\n  getPool (name) {\n    if (this.main === '') {\n      this.putPool({});\n    }\n\n    name = `${name || this.main}`;\n    if (!this.pools[name]) {\n      throw new Error(`Pool '${name}' not found`);\n    }\n\n    return this.pools[name];\n  }\n\n  async runSession (fn, options) {\n    const session = this.openSession(options);\n    try {\n      const result = await fn(session);\n      await session.close();\n      await session.dispose();\n      return result;\n    } catch (err) {\n      await session.dispose();\n      throw err;\n    }\n  }\n\n  openSession (options) {\n    return new Session({ manager: this, options });\n  }\n\n  async end () {\n    await Promise.all(Object.keys(this.pools).map(async name => {\n      const pool = this.pools[name];\n      await pool.drain();\n      await pool.clear();\n    }));\n\n    this.pools = {};\n  }\n}\n\nmodule.exports = Manager;\n","const Pool = require(\"./lib/Pool\");\nconst Deque = require(\"./lib/Deque\");\nconst PriorityQueue = require(\"./lib/PriorityQueue\");\nconst DefaultEvictor = require(\"./lib/DefaultEvictor\");\nmodule.exports = {\n  Pool: Pool,\n  Deque: Deque,\n  PriorityQueue: PriorityQueue,\n  DefaultEvictor: DefaultEvictor,\n  createPool: function(factory, config) {\n    return new Pool(DefaultEvictor, Deque, PriorityQueue, factory, config);\n  }\n};\n","\"use strict\";\n\nconst EventEmitter = require(\"events\").EventEmitter;\n\nconst factoryValidator = require(\"./factoryValidator\");\nconst PoolOptions = require(\"./PoolOptions\");\nconst ResourceRequest = require(\"./ResourceRequest\");\nconst ResourceLoan = require(\"./ResourceLoan\");\nconst PooledResource = require(\"./PooledResource\");\nconst DefaultEvictor = require(\"./DefaultEvictor\");\nconst Deque = require(\"./Deque\");\nconst Deferred = require(\"./Deferred\");\nconst PriorityQueue = require(\"./PriorityQueue\");\nconst DequeIterator = require(\"./DequeIterator\");\n\nconst reflector = require(\"./utils\").reflector;\n\n/**\n * TODO: move me\n */\nconst FACTORY_CREATE_ERROR = \"factoryCreateError\";\nconst FACTORY_DESTROY_ERROR = \"factoryDestroyError\";\n\nclass Pool extends EventEmitter {\n  /**\n   * Generate an Object pool with a specified `factory` and `config`.\n   *\n   * @param {typeof DefaultEvictor} Evictor\n   * @param {typeof Deque} Deque\n   * @param {typeof PriorityQueue} PriorityQueue\n   * @param {Object} factory\n   *   Factory to be used for generating and destroying the items.\n   * @param {Function} factory.create\n   *   Should create the item to be acquired,\n   *   and call it's first callback argument with the generated item as it's argument.\n   * @param {Function} factory.destroy\n   *   Should gently close any resources that the item is using.\n   *   Called before the items is destroyed.\n   * @param {Function} factory.validate\n   *   Test if a resource is still valid .Should return a promise that resolves to a boolean, true if resource is still valid and false\n   *   If it should be removed from pool.\n   * @param {Object} options\n   */\n  constructor(Evictor, Deque, PriorityQueue, factory, options) {\n    super();\n\n    factoryValidator(factory);\n\n    this._config = new PoolOptions(options);\n\n    // TODO: fix up this ugly glue-ing\n    this._Promise = this._config.Promise;\n\n    this._factory = factory;\n    this._draining = false;\n    this._started = false;\n    /**\n     * Holds waiting clients\n     * @type {PriorityQueue}\n     */\n    this._waitingClientsQueue = new PriorityQueue(this._config.priorityRange);\n\n    /**\n     * Collection of promises for resource creation calls made by the pool to factory.create\n     * @type {Set}\n     */\n    this._factoryCreateOperations = new Set();\n\n    /**\n     * Collection of promises for resource destruction calls made by the pool to factory.destroy\n     * @type {Set}\n     */\n    this._factoryDestroyOperations = new Set();\n\n    /**\n     * A queue/stack of pooledResources awaiting acquisition\n     * TODO: replace with LinkedList backed array\n     * @type {Deque}\n     */\n    this._availableObjects = new Deque();\n\n    /**\n     * Collection of references for any resource that are undergoing validation before being acquired\n     * @type {Set}\n     */\n    this._testOnBorrowResources = new Set();\n\n    /**\n     * Collection of references for any resource that are undergoing validation before being returned\n     * @type {Set}\n     */\n    this._testOnReturnResources = new Set();\n\n    /**\n     * Collection of promises for any validations currently in process\n     * @type {Set}\n     */\n    this._validationOperations = new Set();\n\n    /**\n     * All objects associated with this pool in any state (except destroyed)\n     * @type {Set}\n     */\n    this._allObjects = new Set();\n\n    /**\n     * Loans keyed by the borrowed resource\n     * @type {Map}\n     */\n    this._resourceLoans = new Map();\n\n    /**\n     * Infinitely looping iterator over available object\n     * @type {DequeIterator}\n     */\n    this._evictionIterator = this._availableObjects.iterator();\n\n    this._evictor = new Evictor();\n\n    /**\n     * handle for setTimeout for next eviction run\n     * @type {(number|null)}\n     */\n    this._scheduledEviction = null;\n\n    // create initial resources (if factory.min > 0)\n    if (this._config.autostart === true) {\n      this.start();\n    }\n  }\n\n  _destroy(pooledResource) {\n    // FIXME: do we need another state for \"in destruction\"?\n    pooledResource.invalidate();\n    this._allObjects.delete(pooledResource);\n    // NOTE: this maybe very bad promise usage?\n    const destroyPromise = this._factory.destroy(pooledResource.obj);\n    const wrappedDestroyPromise = this._Promise.resolve(destroyPromise);\n\n    this._trackOperation(\n      wrappedDestroyPromise,\n      this._factoryDestroyOperations\n    ).catch(reason => {\n      this.emit(FACTORY_DESTROY_ERROR, reason);\n    });\n\n    // TODO: maybe ensuring minimum pool size should live outside here\n    this._ensureMinimum();\n  }\n\n  /**\n   * Attempt to move an available resource into test and then onto a waiting client\n   * @return {Boolean} could we move an available resource into test\n   */\n  _testOnBorrow() {\n    if (this._availableObjects.length < 1) {\n      return false;\n    }\n\n    const pooledResource = this._availableObjects.shift();\n    // Mark the resource as in test\n    pooledResource.test();\n    this._testOnBorrowResources.add(pooledResource);\n    const validationPromise = this._factory.validate(pooledResource.obj);\n    const wrappedValidationPromise = this._Promise.resolve(validationPromise);\n\n    this._trackOperation(\n      wrappedValidationPromise,\n      this._validationOperations\n    ).then(isValid => {\n      this._testOnBorrowResources.delete(pooledResource);\n\n      if (isValid === false) {\n        pooledResource.invalidate();\n        this._destroy(pooledResource);\n        this._dispense();\n        return;\n      }\n      this._dispatchPooledResourceToNextWaitingClient(pooledResource);\n    });\n\n    return true;\n  }\n\n  /**\n   * Attempt to move an available resource to a waiting client\n   * @return {Boolean} [description]\n   */\n  _dispatchResource() {\n    if (this._availableObjects.length < 1) {\n      return false;\n    }\n\n    const pooledResource = this._availableObjects.shift();\n    this._dispatchPooledResourceToNextWaitingClient(pooledResource);\n    return false;\n  }\n\n  /**\n   * Attempt to resolve an outstanding resource request using an available resource from\n   * the pool, or creating new ones\n   *\n   * @private\n   */\n  _dispense() {\n    /**\n     * Local variables for ease of reading/writing\n     * these don't (shouldn't) change across the execution of this fn\n     */\n    const numWaitingClients = this._waitingClientsQueue.length;\n\n    // If there aren't any waiting requests then there is nothing to do\n    // so lets short-circuit\n    if (numWaitingClients < 1) {\n      return;\n    }\n\n    const resourceShortfall =\n      numWaitingClients - this._potentiallyAllocableResourceCount;\n\n    const actualNumberOfResourcesToCreate = Math.min(\n      this.spareResourceCapacity,\n      resourceShortfall\n    );\n    for (let i = 0; actualNumberOfResourcesToCreate > i; i++) {\n      this._createResource();\n    }\n\n    // If we are doing test-on-borrow see how many more resources need to be moved into test\n    // to help satisfy waitingClients\n    if (this._config.testOnBorrow === true) {\n      // how many available resources do we need to shift into test\n      const desiredNumberOfResourcesToMoveIntoTest =\n        numWaitingClients - this._testOnBorrowResources.size;\n      const actualNumberOfResourcesToMoveIntoTest = Math.min(\n        this._availableObjects.length,\n        desiredNumberOfResourcesToMoveIntoTest\n      );\n      for (let i = 0; actualNumberOfResourcesToMoveIntoTest > i; i++) {\n        this._testOnBorrow();\n      }\n    }\n\n    // if we aren't testing-on-borrow then lets try to allocate what we can\n    if (this._config.testOnBorrow === false) {\n      const actualNumberOfResourcesToDispatch = Math.min(\n        this._availableObjects.length,\n        numWaitingClients\n      );\n      for (let i = 0; actualNumberOfResourcesToDispatch > i; i++) {\n        this._dispatchResource();\n      }\n    }\n  }\n\n  /**\n   * Dispatches a pooledResource to the next waiting client (if any) else\n   * puts the PooledResource back on the available list\n   * @param  {PooledResource} pooledResource [description]\n   * @return {Boolean}                [description]\n   */\n  _dispatchPooledResourceToNextWaitingClient(pooledResource) {\n    const clientResourceRequest = this._waitingClientsQueue.dequeue();\n    if (\n      clientResourceRequest === undefined ||\n      clientResourceRequest.state !== Deferred.PENDING\n    ) {\n      // While we were away either all the waiting clients timed out\n      // or were somehow fulfilled. put our pooledResource back.\n      this._addPooledResourceToAvailableObjects(pooledResource);\n      // TODO: do need to trigger anything before we leave?\n      return false;\n    }\n    const loan = new ResourceLoan(pooledResource, this._Promise);\n    this._resourceLoans.set(pooledResource.obj, loan);\n    pooledResource.allocate();\n    clientResourceRequest.resolve(pooledResource.obj);\n    return true;\n  }\n\n  /**\n   * tracks on operation using given set\n   * handles adding/removing from the set and resolve/rejects the value/reason\n   * @param  {Promise} operation\n   * @param  {Set} set       Set holding operations\n   * @return {Promise}       Promise that resolves once operation has been removed from set\n   */\n  _trackOperation(operation, set) {\n    set.add(operation);\n\n    return operation.then(\n      v => {\n        set.delete(operation);\n        return this._Promise.resolve(v);\n      },\n      e => {\n        set.delete(operation);\n        return this._Promise.reject(e);\n      }\n    );\n  }\n\n  /**\n   * @private\n   */\n  _createResource() {\n    // An attempt to create a resource\n    const factoryPromise = this._factory.create();\n    const wrappedFactoryPromise = this._Promise\n      .resolve(factoryPromise)\n      .then(resource => {\n        const pooledResource = new PooledResource(resource);\n        this._allObjects.add(pooledResource);\n        this._addPooledResourceToAvailableObjects(pooledResource);\n      });\n\n    this._trackOperation(wrappedFactoryPromise, this._factoryCreateOperations)\n      .then(() => {\n        this._dispense();\n        // Stop bluebird complaining about this side-effect only handler\n        // - a promise was created in a handler but was not returned from it\n        // https://goo.gl/rRqMUw\n        return null;\n      })\n      .catch(reason => {\n        this.emit(FACTORY_CREATE_ERROR, reason);\n        this._dispense();\n      });\n  }\n\n  /**\n   * @private\n   */\n  _ensureMinimum() {\n    if (this._draining === true) {\n      return;\n    }\n    const minShortfall = this._config.min - this._count;\n    for (let i = 0; i < minShortfall; i++) {\n      this._createResource();\n    }\n  }\n\n  _evict() {\n    const testsToRun = Math.min(\n      this._config.numTestsPerEvictionRun,\n      this._availableObjects.length\n    );\n    const evictionConfig = {\n      softIdleTimeoutMillis: this._config.softIdleTimeoutMillis,\n      idleTimeoutMillis: this._config.idleTimeoutMillis,\n      min: this._config.min\n    };\n    for (let testsHaveRun = 0; testsHaveRun < testsToRun; ) {\n      const iterationResult = this._evictionIterator.next();\n\n      // Safety check incase we could get stuck in infinite loop because we\n      // somehow emptied the array after chekcing it's length\n      if (iterationResult.done === true && this._availableObjects.length < 1) {\n        this._evictionIterator.reset();\n        return;\n      }\n      // if this happens it should just mean we reached the end of the\n      // list and can reset the cursor.\n      if (iterationResult.done === true && this._availableObjects.length > 0) {\n        this._evictionIterator.reset();\n        continue;\n      }\n\n      const resource = iterationResult.value;\n\n      const shouldEvict = this._evictor.evict(\n        evictionConfig,\n        resource,\n        this._availableObjects.length\n      );\n      testsHaveRun++;\n\n      if (shouldEvict === true) {\n        // take it out of the _availableObjects list\n        this._evictionIterator.remove();\n        this._destroy(resource);\n      }\n    }\n  }\n\n  _scheduleEvictorRun() {\n    // Start eviction if set\n    if (this._config.evictionRunIntervalMillis > 0) {\n      // @ts-ignore\n      this._scheduledEviction = setTimeout(() => {\n        this._evict();\n        this._scheduleEvictorRun();\n      }, this._config.evictionRunIntervalMillis);\n    }\n  }\n\n  _descheduleEvictorRun() {\n    if (this._scheduledEviction) {\n      clearTimeout(this._scheduledEviction);\n    }\n    this._scheduledEviction = null;\n  }\n\n  start() {\n    if (this._draining === true) {\n      return;\n    }\n    if (this._started === true) {\n      return;\n    }\n    this._started = true;\n    this._scheduleEvictorRun();\n    this._ensureMinimum();\n  }\n\n  /**\n   * Request a new resource. The callback will be called,\n   * when a new resource is available, passing the resource to the callback.\n   * TODO: should we add a seperate \"acquireWithPriority\" function\n   *\n   * @param {Number} [priority=0]\n   *   Optional.  Integer between 0 and (priorityRange - 1).  Specifies the priority\n   *   of the caller if there are no available resources.  Lower numbers mean higher\n   *   priority.\n   *\n   * @returns {Promise}\n   */\n  acquire(priority) {\n    if (this._started === false && this._config.autostart === false) {\n      this.start();\n    }\n\n    if (this._draining) {\n      return this._Promise.reject(\n        new Error(\"pool is draining and cannot accept work\")\n      );\n    }\n\n    // TODO: should we defer this check till after this event loop incase \"the situation\" changes in the meantime\n    if (\n      this.spareResourceCapacity < 1 &&\n      this._availableObjects.length < 1 &&\n      this._config.maxWaitingClients !== undefined &&\n      this._waitingClientsQueue.length >= this._config.maxWaitingClients\n    ) {\n      return this._Promise.reject(\n        new Error(\"max waitingClients count exceeded\")\n      );\n    }\n\n    const resourceRequest = new ResourceRequest(\n      this._config.acquireTimeoutMillis,\n      this._Promise\n    );\n    this._waitingClientsQueue.enqueue(resourceRequest, priority);\n    this._dispense();\n\n    return resourceRequest.promise;\n  }\n\n  /**\n   * [use method, aquires a resource, passes the resource to a user supplied function and releases it]\n   * @param  {Function} fn [a function that accepts a resource and returns a promise that resolves/rejects once it has finished using the resource]\n   * @return {Promise}      [resolves once the resource is released to the pool]\n   */\n  use(fn) {\n    return this.acquire().then(resource => {\n      return fn(resource).then(\n        result => {\n          this.release(resource);\n          return result;\n        },\n        err => {\n          this.destroy(resource);\n          throw err;\n        }\n      );\n    });\n  }\n\n  /**\n   * Check if resource is currently on loan from the pool\n   *\n   * @param {Function} resource\n   *    Resource for checking.\n   *\n   * @returns {Boolean}\n   *  True if resource belongs to this pool and false otherwise\n   */\n  isBorrowedResource(resource) {\n    return this._resourceLoans.has(resource);\n  }\n\n  /**\n   * Return the resource to the pool when it is no longer required.\n   *\n   * @param {Object} resource\n   *   The acquired object to be put back to the pool.\n   */\n  release(resource) {\n    // check for an outstanding loan\n    const loan = this._resourceLoans.get(resource);\n\n    if (loan === undefined) {\n      return this._Promise.reject(\n        new Error(\"Resource not currently part of this pool\")\n      );\n    }\n\n    this._resourceLoans.delete(resource);\n    loan.resolve();\n    const pooledResource = loan.pooledResource;\n\n    pooledResource.deallocate();\n    this._addPooledResourceToAvailableObjects(pooledResource);\n\n    this._dispense();\n    return this._Promise.resolve();\n  }\n\n  /**\n   * Request the resource to be destroyed. The factory's destroy handler\n   * will also be called.\n   *\n   * This should be called within an acquire() block as an alternative to release().\n   *\n   * @param {Object} resource\n   *   The acquired resource to be destoyed.\n   */\n  destroy(resource) {\n    // check for an outstanding loan\n    const loan = this._resourceLoans.get(resource);\n\n    if (loan === undefined) {\n      return this._Promise.reject(\n        new Error(\"Resource not currently part of this pool\")\n      );\n    }\n\n    this._resourceLoans.delete(resource);\n    loan.resolve();\n    const pooledResource = loan.pooledResource;\n\n    pooledResource.deallocate();\n    this._destroy(pooledResource);\n\n    this._dispense();\n    return this._Promise.resolve();\n  }\n\n  _addPooledResourceToAvailableObjects(pooledResource) {\n    pooledResource.idle();\n    if (this._config.fifo === true) {\n      this._availableObjects.push(pooledResource);\n    } else {\n      this._availableObjects.unshift(pooledResource);\n    }\n  }\n\n  /**\n   * Disallow any new acquire calls and let the request backlog dissapate.\n   * The Pool will no longer attempt to maintain a \"min\" number of resources\n   * and will only make new resources on demand.\n   * Resolves once all resource requests are fulfilled and all resources are returned to pool and available...\n   * Should probably be called \"drain work\"\n   * @returns {Promise}\n   */\n  drain() {\n    this._draining = true;\n    return this.__allResourceRequestsSettled()\n      .then(() => {\n        return this.__allResourcesReturned();\n      })\n      .then(() => {\n        this._descheduleEvictorRun();\n      });\n  }\n\n  __allResourceRequestsSettled() {\n    if (this._waitingClientsQueue.length > 0) {\n      // wait for last waiting client to be settled\n      // FIXME: what if they can \"resolve\" out of order....?\n      return reflector(this._waitingClientsQueue.tail.promise);\n    }\n    return this._Promise.resolve();\n  }\n\n  // FIXME: this is a horrific mess\n  __allResourcesReturned() {\n    const ps = Array.from(this._resourceLoans.values())\n      .map(loan => loan.promise)\n      .map(reflector);\n    return this._Promise.all(ps);\n  }\n\n  /**\n   * Forcibly destroys all available resources regardless of timeout.  Intended to be\n   * invoked as part of a drain.  Does not prevent the creation of new\n   * resources as a result of subsequent calls to acquire.\n   *\n   * Note that if factory.min > 0 and the pool isn't \"draining\", the pool will destroy all idle resources\n   * in the pool, but replace them with newly created resources up to the\n   * specified factory.min value.  If this is not desired, set factory.min\n   * to zero before calling clear()\n   *\n   */\n  clear() {\n    const reflectedCreatePromises = Array.from(\n      this._factoryCreateOperations\n    ).map(reflector);\n\n    // wait for outstanding factory.create to complete\n    return this._Promise.all(reflectedCreatePromises).then(() => {\n      // Destroy existing resources\n      // @ts-ignore\n      for (const resource of this._availableObjects) {\n        this._destroy(resource);\n      }\n      const reflectedDestroyPromises = Array.from(\n        this._factoryDestroyOperations\n      ).map(reflector);\n      return reflector(this._Promise.all(reflectedDestroyPromises));\n    });\n  }\n\n  /**\n   * How many resources are available to allocated\n   * (includes resources that have not been tested and may faul validation)\n   * NOTE: internal for now as the name is awful and might not be useful to anyone\n   * @return {Number} number of resources the pool has to allocate\n   */\n  get _potentiallyAllocableResourceCount() {\n    return (\n      this._availableObjects.length +\n      this._testOnBorrowResources.size +\n      this._testOnReturnResources.size +\n      this._factoryCreateOperations.size\n    );\n  }\n\n  /**\n   * The combined count of the currently created objects and those in the\n   * process of being created\n   * Does NOT include resources in the process of being destroyed\n   * sort of legacy...\n   * @return {Number}\n   */\n  get _count() {\n    return this._allObjects.size + this._factoryCreateOperations.size;\n  }\n\n  /**\n   * How many more resources does the pool have room for\n   * @return {Number} number of resources the pool could create before hitting any limits\n   */\n  get spareResourceCapacity() {\n    return (\n      this._config.max -\n      (this._allObjects.size + this._factoryCreateOperations.size)\n    );\n  }\n\n  /**\n   * see _count above\n   * @return {Number} [description]\n   */\n  get size() {\n    return this._count;\n  }\n\n  /**\n   * number of available resources\n   * @return {Number} [description]\n   */\n  get available() {\n    return this._availableObjects.length;\n  }\n\n  /**\n   * number of resources that are currently acquired\n   * @return {Number} [description]\n   */\n  get borrowed() {\n    return this._resourceLoans.size;\n  }\n\n  /**\n   * number of waiting acquire calls\n   * @return {Number} [description]\n   */\n  get pending() {\n    return this._waitingClientsQueue.length;\n  }\n\n  /**\n   * maximum size of the pool\n   * @return {Number} [description]\n   */\n  get max() {\n    return this._config.max;\n  }\n\n  /**\n   * minimum size of the pool\n   * @return {Number} [description]\n   */\n  get min() {\n    return this._config.min;\n  }\n}\n\nmodule.exports = Pool;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = $getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  var args = [];\n  for (var i = 0; i < arguments.length; i++) args.push(arguments[i]);\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    ReflectApply(this.listener, this.target, args);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function') {\n        throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n      }\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","module.exports = function(factory) {\n  if (typeof factory.create !== \"function\") {\n    throw new TypeError(\"factory.create must be a function\");\n  }\n\n  if (typeof factory.destroy !== \"function\") {\n    throw new TypeError(\"factory.destroy must be a function\");\n  }\n\n  if (\n    typeof factory.validate !== \"undefined\" &&\n    typeof factory.validate !== \"function\"\n  ) {\n    throw new TypeError(\"factory.validate must be a function\");\n  }\n};\n","\"use strict\";\n\nconst PoolDefaults = require(\"./PoolDefaults\");\n\nclass PoolOptions {\n  /**\n   * @param {Object} opts\n   *   configuration for the pool\n   * @param {Number} [opts.max=null]\n   *   Maximum number of items that can exist at the same time.  Default: 1.\n   *   Any further acquire requests will be pushed to the waiting list.\n   * @param {Number} [opts.min=null]\n   *   Minimum number of items in pool (including in-use). Default: 0.\n   *   When the pool is created, or a resource destroyed, this minimum will\n   *   be checked. If the pool resource count is below the minimum, a new\n   *   resource will be created and added to the pool.\n   * @param {Number} [opts.maxWaitingClients=null]\n   *   maximum number of queued requests allowed after which acquire calls will be rejected\n   * @param {Boolean} [opts.testOnBorrow=false]\n   *   should the pool validate resources before giving them to clients. Requires that\n   *   `factory.validate` is specified.\n   * @param {Boolean} [opts.testOnReturn=false]\n   *   should the pool validate resources before returning them to the pool.\n   * @param {Number} [opts.acquireTimeoutMillis=null]\n   *   Delay in milliseconds after which the an `acquire` call will fail. optional.\n   *   Default: undefined. Should be positive and non-zero\n   * @param {Number} [opts.priorityRange=1]\n   *   The range from 1 to be treated as a valid priority\n   * @param {Boolean} [opts.fifo=true]\n   *   Sets whether the pool has LIFO (last in, first out) behaviour with respect to idle objects.\n   *   if false then pool has FIFO behaviour\n   * @param {Boolean} [opts.autostart=true]\n   *   Should the pool start creating resources etc once the constructor is called\n   * @param {Number} [opts.evictionRunIntervalMillis=0]\n   *   How often to run eviction checks.  Default: 0 (does not run).\n   * @param {Number} [opts.numTestsPerEvictionRun=3]\n   *   Number of resources to check each eviction run.  Default: 3.\n   * @param {Number} [opts.softIdleTimeoutMillis=-1]\n   *   amount of time an object may sit idle in the pool before it is eligible\n   *   for eviction by the idle object evictor (if any), with the extra condition\n   *   that at least \"min idle\" object instances remain in the pool. Default -1 (nothing can get evicted)\n   * @param {Number} [opts.idleTimeoutMillis=30000]\n   *   the minimum amount of time that an object may sit idle in the pool before it is eligible for eviction\n   *   due to idle time. Supercedes \"softIdleTimeoutMillis\" Default: 30000\n   * @param {typeof Promise} [opts.Promise=Promise]\n   *   What promise implementation should the pool use, defaults to native promises.\n   */\n  constructor(opts) {\n    const poolDefaults = new PoolDefaults();\n\n    opts = opts || {};\n\n    this.fifo = typeof opts.fifo === \"boolean\" ? opts.fifo : poolDefaults.fifo;\n    this.priorityRange = opts.priorityRange || poolDefaults.priorityRange;\n\n    this.testOnBorrow =\n      typeof opts.testOnBorrow === \"boolean\"\n        ? opts.testOnBorrow\n        : poolDefaults.testOnBorrow;\n    this.testOnReturn =\n      typeof opts.testOnReturn === \"boolean\"\n        ? opts.testOnReturn\n        : poolDefaults.testOnReturn;\n\n    this.autostart =\n      typeof opts.autostart === \"boolean\"\n        ? opts.autostart\n        : poolDefaults.autostart;\n\n    if (opts.acquireTimeoutMillis) {\n      // @ts-ignore\n      this.acquireTimeoutMillis = parseInt(opts.acquireTimeoutMillis, 10);\n    }\n\n    if (opts.maxWaitingClients !== undefined) {\n      // @ts-ignore\n      this.maxWaitingClients = parseInt(opts.maxWaitingClients, 10);\n    }\n\n    // @ts-ignore\n    this.max = parseInt(opts.max, 10);\n    // @ts-ignore\n    this.min = parseInt(opts.min, 10);\n\n    this.max = Math.max(isNaN(this.max) ? 1 : this.max, 1);\n    this.min = Math.min(isNaN(this.min) ? 0 : this.min, this.max);\n\n    this.evictionRunIntervalMillis =\n      opts.evictionRunIntervalMillis || poolDefaults.evictionRunIntervalMillis;\n    this.numTestsPerEvictionRun =\n      opts.numTestsPerEvictionRun || poolDefaults.numTestsPerEvictionRun;\n    this.softIdleTimeoutMillis =\n      opts.softIdleTimeoutMillis || poolDefaults.softIdleTimeoutMillis;\n    this.idleTimeoutMillis =\n      opts.idleTimeoutMillis || poolDefaults.idleTimeoutMillis;\n\n    this.Promise = opts.Promise != null ? opts.Promise : poolDefaults.Promise;\n  }\n}\n\nmodule.exports = PoolOptions;\n","\"use strict\";\n/**\n * Create the default settings used by the pool\n *\n * @class\n */\nclass PoolDefaults {\n  constructor() {\n    this.fifo = true;\n    this.priorityRange = 1;\n\n    this.testOnBorrow = false;\n    this.testOnReturn = false;\n\n    this.autostart = true;\n\n    this.evictionRunIntervalMillis = 0;\n    this.numTestsPerEvictionRun = 3;\n    this.softIdleTimeoutMillis = -1;\n    this.idleTimeoutMillis = 30000;\n\n    // FIXME: no defaults!\n    this.acquireTimeoutMillis = null;\n    this.maxWaitingClients = null;\n\n    this.min = null;\n    this.max = null;\n    // FIXME: this seems odd?\n    this.Promise = Promise;\n  }\n}\n\nmodule.exports = PoolDefaults;\n","\"use strict\";\n\nconst Deferred = require(\"./Deferred\");\nconst errors = require(\"./errors\");\n\nfunction fbind(fn, ctx) {\n  return function bound() {\n    return fn.apply(ctx, arguments);\n  };\n}\n\n/**\n * Wraps a users request for a resource\n * Basically a promise mashed in with a timeout\n * @private\n */\nclass ResourceRequest extends Deferred {\n  /**\n   * [constructor description]\n   * @param  {Number} ttl     timeout\n   */\n  constructor(ttl, Promise) {\n    super(Promise);\n    this._creationTimestamp = Date.now();\n    this._timeout = null;\n\n    if (ttl !== undefined) {\n      this.setTimeout(ttl);\n    }\n  }\n\n  setTimeout(delay) {\n    if (this._state !== ResourceRequest.PENDING) {\n      return;\n    }\n    const ttl = parseInt(delay, 10);\n\n    if (isNaN(ttl) || ttl <= 0) {\n      throw new Error(\"delay must be a positive int\");\n    }\n\n    const age = Date.now() - this._creationTimestamp;\n\n    if (this._timeout) {\n      this.removeTimeout();\n    }\n\n    this._timeout = setTimeout(\n      fbind(this._fireTimeout, this),\n      Math.max(ttl - age, 0)\n    );\n  }\n\n  removeTimeout() {\n    if (this._timeout) {\n      clearTimeout(this._timeout);\n    }\n    this._timeout = null;\n  }\n\n  _fireTimeout() {\n    this.reject(new errors.TimeoutError(\"ResourceRequest timed out\"));\n  }\n\n  reject(reason) {\n    this.removeTimeout();\n    super.reject(reason);\n  }\n\n  resolve(value) {\n    this.removeTimeout();\n    super.resolve(value);\n  }\n}\n\nmodule.exports = ResourceRequest;\n","\"use strict\";\n\nclass ExtendableError extends Error {\n  constructor(message) {\n    super(message);\n    // @ts-ignore\n    this.name = this.constructor.name;\n    this.message = message;\n    if (typeof Error.captureStackTrace === \"function\") {\n      Error.captureStackTrace(this, this.constructor);\n    } else {\n      this.stack = new Error(message).stack;\n    }\n  }\n}\n\n/* eslint-disable no-useless-constructor */\nclass TimeoutError extends ExtendableError {\n  constructor(m) {\n    super(m);\n  }\n}\n/* eslint-enable no-useless-constructor */\n\nmodule.exports = {\n  TimeoutError: TimeoutError\n};\n","\"use strict\";\n\nconst Deferred = require(\"./Deferred\");\n\n/**\n * Plan is to maybe add tracking via Error objects\n * and other fun stuff!\n */\n\nclass ResourceLoan extends Deferred {\n  /**\n   *\n   * @param  {any} pooledResource the PooledResource this loan belongs to\n   * @return {any}                [description]\n   */\n  constructor(pooledResource, Promise) {\n    super(Promise);\n    this._creationTimestamp = Date.now();\n    this.pooledResource = pooledResource;\n  }\n\n  reject() {\n    /**\n     * Loans can only be resolved at the moment\n     */\n  }\n}\n\nmodule.exports = ResourceLoan;\n","\"use strict\";\n\nconst PooledResourceStateEnum = require(\"./PooledResourceStateEnum\");\n\n/**\n * @class\n * @private\n */\nclass PooledResource {\n  constructor(resource) {\n    this.creationTime = Date.now();\n    this.lastReturnTime = null;\n    this.lastBorrowTime = null;\n    this.lastIdleTime = null;\n    this.obj = resource;\n    this.state = PooledResourceStateEnum.IDLE;\n  }\n\n  // mark the resource as \"allocated\"\n  allocate() {\n    this.lastBorrowTime = Date.now();\n    this.state = PooledResourceStateEnum.ALLOCATED;\n  }\n\n  // mark the resource as \"deallocated\"\n  deallocate() {\n    this.lastReturnTime = Date.now();\n    this.state = PooledResourceStateEnum.IDLE;\n  }\n\n  invalidate() {\n    this.state = PooledResourceStateEnum.INVALID;\n  }\n\n  test() {\n    this.state = PooledResourceStateEnum.VALIDATION;\n  }\n\n  idle() {\n    this.lastIdleTime = Date.now();\n    this.state = PooledResourceStateEnum.IDLE;\n  }\n\n  returning() {\n    this.state = PooledResourceStateEnum.RETURNING;\n  }\n}\n\nmodule.exports = PooledResource;\n","\"use strict\";\n\nconst PooledResourceStateEnum = {\n  ALLOCATED: \"ALLOCATED\", // In use\n  IDLE: \"IDLE\", // In the queue, not in use.\n  INVALID: \"INVALID\", // Failed validation\n  RETURNING: \"RETURNING\", // Resource is in process of returning\n  VALIDATION: \"VALIDATION\" // Currently being tested\n};\n\nmodule.exports = PooledResourceStateEnum;\n","\"use strict\";\n\n/**\n * Creates an interator for a DoublyLinkedList starting at the given node\n * It's internal cursor will remains relative to the last \"iterated\" node as that\n * node moves through the list until it either iterates to the end of the list,\n * or the the node it's tracking is removed from the list. Until the first 'next'\n * call it tracks the head/tail of the linked list. This means that one can create\n * an iterator on an empty list, then add nodes, and then the iterator will follow\n * those nodes. Because the DoublyLinkedList nodes don't track their owning \"list\" and\n * it's highly inefficient to walk the list for every iteration, the iterator won't know\n * if the node has been detached from one List and added to another list, or if the iterator\n *\n * The created object is an es6 compatible iterator\n */\nclass DoublyLinkedListIterator {\n  /**\n   * @param  {Object} doublyLinkedList     a node that is part of a doublyLinkedList\n   * @param  {Boolean} [reverse=false]     is this a reverse iterator? default: false\n   */\n  constructor(doublyLinkedList, reverse) {\n    this._list = doublyLinkedList;\n    // NOTE: these key names are tied to the DoublyLinkedListIterator\n    this._direction = reverse === true ? \"prev\" : \"next\";\n    this._startPosition = reverse === true ? \"tail\" : \"head\";\n    this._started = false;\n    this._cursor = null;\n    this._done = false;\n  }\n\n  _start() {\n    this._cursor = this._list[this._startPosition];\n    this._started = true;\n  }\n\n  _advanceCursor() {\n    if (this._started === false) {\n      this._started = true;\n      this._cursor = this._list[this._startPosition];\n      return;\n    }\n    this._cursor = this._cursor[this._direction];\n  }\n\n  reset() {\n    this._done = false;\n    this._started = false;\n    this._cursor = null;\n  }\n\n  remove() {\n    if (\n      this._started === false ||\n      this._done === true ||\n      this._isCursorDetached()\n    ) {\n      return false;\n    }\n    this._list.remove(this._cursor);\n  }\n\n  next() {\n    if (this._done === true) {\n      return { done: true };\n    }\n\n    this._advanceCursor();\n\n    // if there is no node at the cursor or the node at the cursor is no longer part of\n    // a doubly linked list then we are done/finished/kaput\n    if (this._cursor === null || this._isCursorDetached()) {\n      this._done = true;\n      return { done: true };\n    }\n\n    return {\n      value: this._cursor,\n      done: false\n    };\n  }\n\n  /**\n   * Is the node detached from a list?\n   * NOTE: you can trick/bypass/confuse this check by removing a node from one DoublyLinkedList\n   * and adding it to another.\n   * TODO: We can make this smarter by checking the direction of travel and only checking\n   * the required next/prev/head/tail rather than all of them\n   * @return {Boolean}      [description]\n   */\n  _isCursorDetached() {\n    return (\n      this._cursor.prev === null &&\n      this._cursor.next === null &&\n      this._list.tail !== this._cursor &&\n      this._list.head !== this._cursor\n    );\n  }\n}\n\nmodule.exports = DoublyLinkedListIterator;\n","\"use strict\";\n\nconst DoublyLinkedList = require(\"./DoublyLinkedList\");\nconst Deque = require(\"./Deque\");\n\n/**\n * Sort of a internal queue for holding the waiting\n * resource requets for a given \"priority\".\n * Also handles managing timeouts rejections on items (is this the best place for this?)\n * This is the last point where we know which queue a resourceRequest is in\n *\n */\nclass Queue extends Deque {\n  /**\n   * Adds the obj to the end of the list for this slot\n   * we completely override the parent method because we need access to the\n   * node for our rejection handler\n   * @param {any} resourceRequest [description]\n   */\n  push(resourceRequest) {\n    const node = DoublyLinkedList.createNode(resourceRequest);\n    resourceRequest.promise.catch(this._createTimeoutRejectionHandler(node));\n    this._list.insertEnd(node);\n  }\n\n  _createTimeoutRejectionHandler(node) {\n    return reason => {\n      if (reason.name === \"TimeoutError\") {\n        this._list.remove(node);\n      }\n    };\n  }\n}\n\nmodule.exports = Queue;\n","\"use strict\";\n\nfunction noop() {}\n\n/**\n * Reflects a promise but does not expose any\n * underlying value or rejection from that promise.\n * @param  {Promise} promise [description]\n * @return {Promise}         [description]\n */\nexports.reflector = function(promise) {\n  return promise.then(noop, noop);\n};\n","class Filter extends Error {\n  constructor () {\n    super();\n\n    this.status = 400;\n    this.children = [];\n  }\n\n  get message () {\n    return this.children.map(child => child.message).join(', ');\n  }\n\n  add (value) {\n    this.children.push(value);\n  }\n\n  empty () {\n    return this.children.length === 0;\n  }\n}\n\nmodule.exports = Filter;\n","'use strict'\n\n/**\n * Expose compositor.\n */\n\nmodule.exports = compose\n\n/**\n * Compose `middleware` returning\n * a fully valid middleware comprised\n * of all those which are passed.\n *\n * @param {Array} middleware\n * @return {Function}\n * @api public\n */\n\nfunction compose (middleware) {\n  if (!Array.isArray(middleware)) throw new TypeError('Middleware stack must be an array!')\n  for (const fn of middleware) {\n    if (typeof fn !== 'function') throw new TypeError('Middleware must be composed of functions!')\n  }\n\n  /**\n   * @param {Object} context\n   * @return {Promise}\n   * @api public\n   */\n\n  return function (context, next) {\n    // last called middleware #\n    let index = -1\n    return dispatch(0)\n    function dispatch (i) {\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\n      index = i\n      let fn = middleware[i]\n      if (i === middleware.length) fn = next\n      if (!fn) return Promise.resolve()\n      try {\n        return Promise.resolve(fn(context, dispatch.bind(null, i + 1)));\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n  }\n}\n","const Query = require('./query');\nconst Factory = require('async-factory');\nconst connectionFactory = new Factory();\n\nlet sessionNextId = 0;\n\nclass Session {\n  constructor ({ manager, options = {} }) {\n    this.id = `session-${sessionNextId++}`;\n    this.manager = manager;\n    this.connections = {};\n    this.state = Object.assign({}, options.state);\n  }\n\n  factory (schema, criteria) {\n    return new Query({ session: this, schema, criteria });\n  }\n\n  async acquire (name) {\n    const pool = this.manager.getPool(name);\n\n    if (!this.connections[pool.name]) {\n      const id = `${this.id}-${pool.name}`;\n      this.connections[pool.name] = await connectionFactory.singleton(id, () => pool.acquire());\n\n      await this.connections[pool.name].begin();\n    }\n\n    return this.connections[pool.name];\n  }\n\n  async dispose () {\n    await this.rollback();\n    await Promise.all(Object.keys(this.connections).map(name => {\n      return this.manager.getPool(name).release(this.connections[name]);\n    }));\n\n    this.connections = {};\n  }\n\n  close () {\n    return this.commit();\n  }\n\n  async commit () {\n    await Promise.all(Object.keys(this.connections).map(async name => {\n      const connection = this.connections[name];\n      await connection.commit();\n    }));\n  }\n\n  async rollback () {\n    await Promise.all(Object.keys(this.connections).map(async name => {\n      const connection = this.connections[name];\n      await connection.rollback();\n    }));\n  }\n\n  async begin () {\n    await Promise.all(Object.keys(this.connections).map(async name => {\n      const connection = this.connections[name];\n      await connection.begin();\n    }));\n  }\n\n  async flush () {\n    await this.commit();\n    await this.begin();\n  }\n\n  parseSchema (name) {\n    let connection;\n    let schema;\n    if (Array.isArray(name)) {\n      if (name.length < 2) {\n        throw new Error('Malformed schema name tupple');\n      }\n      [connection, schema] = name;\n    } else if (name.indexOf('.') !== -1) {\n      [connection, schema] = name.split('.');\n    } else {\n      connection = this.manager.getPool().name;\n      schema = name;\n    }\n\n    const pool = this.manager.getPool(connection);\n    return [pool.name, pool.getSchema(schema)];\n  }\n}\n\nmodule.exports = Session;\n","class Space {\n  constructor (fn) {\n    this.fn = fn;\n    this.locks = [];\n    this.done = false;\n  }\n\n  async fetch () {\n    if (!this.done) {\n      await new Promise(async (resolve, reject) => {\n        this.locks.push([ resolve, reject ]);\n\n        if (this.locks.length > 1) {\n          return;\n        }\n\n        try {\n          let { fn } = this;\n          this.value = await fn();\n        } catch (err) {\n          this.error = err;\n        }\n\n        this.done = true;\n        this.locks.splice(0).forEach(([ resolve, reject ]) => {\n          if (this.error) {\n            reject(this.error);\n          } else {\n            resolve(this.value);\n          }\n        });\n      });\n    }\n\n    if (this.error) {\n      throw this.error;\n    }\n\n    return this.value;\n  }\n}\n\nclass Factory {\n  constructor () {\n    this.spaces = new Map();\n  }\n\n  async singleton (key, fn) {\n    fn = fn || key;\n\n    let space;\n    if (this.spaces.has(key)) {\n      space = this.spaces.get(key);\n    } else {\n      space = new Space(fn);\n      this.spaces.set(key, space);\n    }\n\n    return space.fetch(); // return promise\n  }\n}\n\nmodule.exports = Factory;\n","module.exports = {\n  NBoolean: require('./nboolean'),\n  NDatetime: require('./ndatetime'),\n  NDouble: require('./ndouble'),\n  NField: require('./nfield'),\n  NInteger: require('./ninteger'),\n  NReference: require('./nreference'),\n  NString: require('./nstring'),\n  NText: require('./ntext'),\n  NList: require('./nlist'),\n  NMap: require('./nmap'),\n  NBig: require('./nbig'),\n};\n","const NField = require('./nfield');\n\nmodule.exports = class NBoolean extends NField {\n  attach (value) {\n    if (value === undefined || value === null) {\n      return null;\n    }\n\n    if (value === 'false' || value === '0' || value === '') {\n      return false;\n    }\n\n    return Boolean(value);\n  }\n};\n","const NField = require('./nfield');\n\nmodule.exports = class NDouble extends NField {\n  attach (value) {\n    value = super.attach(value);\n    if (value === null) {\n      return null;\n    }\n\n    value = parseFloat(value);\n    if (isNaN(value)) {\n      throw new Error('Invalid double value');\n    }\n\n    return value;\n  }\n\n  compare (criteria, value) {\n    if (value === undefined) {\n      value = null;\n    }\n\n    if (criteria === value) {\n      return 0;\n    }\n\n    if (criteria === null) {\n      return 1;\n    }\n\n    return value - criteria;\n  }\n};\n","const NField = require('./nfield');\n\nmodule.exports = class NInteger extends NField {\n  attach (value) {\n    value = super.attach(value);\n    if (value === null) {\n      return null;\n    }\n\n    value = parseInt(value, 10);\n    if (isNaN(value)) {\n      throw new Error('Invalid integer value');\n    }\n\n    return value;\n  }\n\n  compare (criteria, value) {\n    if (value === undefined) {\n      value = null;\n    }\n\n    if (criteria === value) {\n      return 0;\n    }\n\n    if (criteria === null) {\n      return 1;\n    }\n\n    return value - criteria;\n  }\n};\n","const NField = require('./nfield');\n\nmodule.exports = class NReference extends NField {\n  to (to) {\n    this.to = to;\n\n    return this;\n  }\n};\n","const NField = require('./nfield');\n\nmodule.exports = class NText extends NField {\n\n};\n","const NField = require('./nfield');\n\nmodule.exports = class NList extends NField {\n  of (childField) {\n    this.childField = childField;\n\n    return this;\n  }\n\n  attach (value) {\n    value = super.attach(value);\n    if (value === null) {\n      return null;\n    }\n\n    if (typeof value === 'string') {\n      try {\n        value = JSON.parse(value);\n      } catch (err) {\n        throw new Error('Invalid list value');\n      }\n    }\n\n    if (!Array.isArray(value)) {\n      throw new Error('Invalid list value');\n    }\n\n    if (this.childField) {\n      value = value.map(o => this.childField.attach(o));\n    }\n\n    return value;\n  }\n};\n","const NField = require('./nfield');\n\nmodule.exports = class NMap extends NField {\n  attach (value) {\n    value = super.attach(value);\n    if (value === null) {\n      return null;\n    }\n\n    if (typeof value === 'string') {\n      try {\n        value = JSON.parse(value);\n      } catch (err) {\n        throw new Error('Invalid map value');\n      }\n    }\n\n    if (typeof value !== 'object' || Array.isArray(value)) {\n      throw new Error('Invalid map value');\n    }\n\n    return value;\n  }\n\n  compare (criteria, value) {\n    if (value === undefined) {\n      value = null;\n    }\n\n    if (criteria === value) {\n      return 0;\n    }\n\n    if (criteria === null) {\n      return 1;\n    }\n\n    const criteriaKeys = Object.getOwnPropertyNames(criteria);\n    const valueKeys = Object.getOwnPropertyNames(value);\n\n    if (criteriaKeys.length !== valueKeys.length) {\n      return 1;\n    }\n\n    for (const key of criteriaKeys) { // eslint-disable-line no-unused-vars\n      if (!valueKeys.includes(key)) {\n        return 1;\n      }\n\n      if (criteria[key] !== value[key]) {\n        return 1;\n      }\n    }\n\n    return 0;\n  }\n};\n","const NField = require('./nfield');\nconst Big = require('big.js');\n\nmodule.exports = class NBig extends NField {\n  attach (value) {\n    value = super.attach(value);\n\n    if (value === null) {\n      return null;\n    }\n\n    try {\n      return new Big(value);\n    } catch (err) {\n      throw new Error('Invalid big value');\n    }\n  }\n\n  compare (criteria, value) {\n    if (value === undefined) {\n      value = null;\n    }\n\n    if (criteria === value) {\n      return 0;\n    }\n\n    if (criteria === null) {\n      return 1;\n    }\n\n    return new Big(value).cmp(criteria);\n  }\n\n  serialize (value) {\n    if (value === null) {\n      return value;\n    }\n\n    return value.toJSON();\n  }\n};\n","/*\r\n *  big.js v5.2.2\r\n *  A small, fast, easy-to-use library for arbitrary-precision decimal arithmetic.\r\n *  Copyright (c) 2018 Michael Mclaughlin <M8ch88l@gmail.com>\r\n *  https://github.com/MikeMcl/big.js/LICENCE\r\n */\r\n;(function (GLOBAL) {\r\n  'use strict';\r\n  var Big,\r\n\r\n\r\n/************************************** EDITABLE DEFAULTS *****************************************/\r\n\r\n\r\n    // The default values below must be integers within the stated ranges.\r\n\r\n    /*\r\n     * The maximum number of decimal places (DP) of the results of operations involving division:\r\n     * div and sqrt, and pow with negative exponents.\r\n     */\r\n    DP = 20,          // 0 to MAX_DP\r\n\r\n    /*\r\n     * The rounding mode (RM) used when rounding to the above decimal places.\r\n     *\r\n     *  0  Towards zero (i.e. truncate, no rounding).       (ROUND_DOWN)\r\n     *  1  To nearest neighbour. If equidistant, round up.  (ROUND_HALF_UP)\r\n     *  2  To nearest neighbour. If equidistant, to even.   (ROUND_HALF_EVEN)\r\n     *  3  Away from zero.                                  (ROUND_UP)\r\n     */\r\n    RM = 1,             // 0, 1, 2 or 3\r\n\r\n    // The maximum value of DP and Big.DP.\r\n    MAX_DP = 1E6,       // 0 to 1000000\r\n\r\n    // The maximum magnitude of the exponent argument to the pow method.\r\n    MAX_POWER = 1E6,    // 1 to 1000000\r\n\r\n    /*\r\n     * The negative exponent (NE) at and beneath which toString returns exponential notation.\r\n     * (JavaScript numbers: -7)\r\n     * -1000000 is the minimum recommended exponent value of a Big.\r\n     */\r\n    NE = -7,            // 0 to -1000000\r\n\r\n    /*\r\n     * The positive exponent (PE) at and above which toString returns exponential notation.\r\n     * (JavaScript numbers: 21)\r\n     * 1000000 is the maximum recommended exponent value of a Big.\r\n     * (This limit is not enforced or checked.)\r\n     */\r\n    PE = 21,            // 0 to 1000000\r\n\r\n\r\n/**************************************************************************************************/\r\n\r\n\r\n    // Error messages.\r\n    NAME = '[big.js] ',\r\n    INVALID = NAME + 'Invalid ',\r\n    INVALID_DP = INVALID + 'decimal places',\r\n    INVALID_RM = INVALID + 'rounding mode',\r\n    DIV_BY_ZERO = NAME + 'Division by zero',\r\n\r\n    // The shared prototype object.\r\n    P = {},\r\n    UNDEFINED = void 0,\r\n    NUMERIC = /^-?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?$/i;\r\n\r\n\r\n  /*\r\n   * Create and return a Big constructor.\r\n   *\r\n   */\r\n  function _Big_() {\r\n\r\n    /*\r\n     * The Big constructor and exported function.\r\n     * Create and return a new instance of a Big number object.\r\n     *\r\n     * n {number|string|Big} A numeric value.\r\n     */\r\n    function Big(n) {\r\n      var x = this;\r\n\r\n      // Enable constructor usage without new.\r\n      if (!(x instanceof Big)) return n === UNDEFINED ? _Big_() : new Big(n);\r\n\r\n      // Duplicate.\r\n      if (n instanceof Big) {\r\n        x.s = n.s;\r\n        x.e = n.e;\r\n        x.c = n.c.slice();\r\n      } else {\r\n        parse(x, n);\r\n      }\r\n\r\n      /*\r\n       * Retain a reference to this Big constructor, and shadow Big.prototype.constructor which\r\n       * points to Object.\r\n       */\r\n      x.constructor = Big;\r\n    }\r\n\r\n    Big.prototype = P;\r\n    Big.DP = DP;\r\n    Big.RM = RM;\r\n    Big.NE = NE;\r\n    Big.PE = PE;\r\n    Big.version = '5.2.2';\r\n\r\n    return Big;\r\n  }\r\n\r\n\r\n  /*\r\n   * Parse the number or string value passed to a Big constructor.\r\n   *\r\n   * x {Big} A Big number instance.\r\n   * n {number|string} A numeric value.\r\n   */\r\n  function parse(x, n) {\r\n    var e, i, nl;\r\n\r\n    // Minus zero?\r\n    if (n === 0 && 1 / n < 0) n = '-0';\r\n    else if (!NUMERIC.test(n += '')) throw Error(INVALID + 'number');\r\n\r\n    // Determine sign.\r\n    x.s = n.charAt(0) == '-' ? (n = n.slice(1), -1) : 1;\r\n\r\n    // Decimal point?\r\n    if ((e = n.indexOf('.')) > -1) n = n.replace('.', '');\r\n\r\n    // Exponential form?\r\n    if ((i = n.search(/e/i)) > 0) {\r\n\r\n      // Determine exponent.\r\n      if (e < 0) e = i;\r\n      e += +n.slice(i + 1);\r\n      n = n.substring(0, i);\r\n    } else if (e < 0) {\r\n\r\n      // Integer.\r\n      e = n.length;\r\n    }\r\n\r\n    nl = n.length;\r\n\r\n    // Determine leading zeros.\r\n    for (i = 0; i < nl && n.charAt(i) == '0';) ++i;\r\n\r\n    if (i == nl) {\r\n\r\n      // Zero.\r\n      x.c = [x.e = 0];\r\n    } else {\r\n\r\n      // Determine trailing zeros.\r\n      for (; nl > 0 && n.charAt(--nl) == '0';);\r\n      x.e = e - i - 1;\r\n      x.c = [];\r\n\r\n      // Convert string to array of digits without leading/trailing zeros.\r\n      for (e = 0; i <= nl;) x.c[e++] = +n.charAt(i++);\r\n    }\r\n\r\n    return x;\r\n  }\r\n\r\n\r\n  /*\r\n   * Round Big x to a maximum of dp decimal places using rounding mode rm.\r\n   * Called by stringify, P.div, P.round and P.sqrt.\r\n   *\r\n   * x {Big} The Big to round.\r\n   * dp {number} Integer, 0 to MAX_DP inclusive.\r\n   * rm {number} 0, 1, 2 or 3 (DOWN, HALF_UP, HALF_EVEN, UP)\r\n   * [more] {boolean} Whether the result of division was truncated.\r\n   */\r\n  function round(x, dp, rm, more) {\r\n    var xc = x.c,\r\n      i = x.e + dp + 1;\r\n\r\n    if (i < xc.length) {\r\n      if (rm === 1) {\r\n\r\n        // xc[i] is the digit after the digit that may be rounded up.\r\n        more = xc[i] >= 5;\r\n      } else if (rm === 2) {\r\n        more = xc[i] > 5 || xc[i] == 5 &&\r\n          (more || i < 0 || xc[i + 1] !== UNDEFINED || xc[i - 1] & 1);\r\n      } else if (rm === 3) {\r\n        more = more || !!xc[0];\r\n      } else {\r\n        more = false;\r\n        if (rm !== 0) throw Error(INVALID_RM);\r\n      }\r\n\r\n      if (i < 1) {\r\n        xc.length = 1;\r\n\r\n        if (more) {\r\n\r\n          // 1, 0.1, 0.01, 0.001, 0.0001 etc.\r\n          x.e = -dp;\r\n          xc[0] = 1;\r\n        } else {\r\n\r\n          // Zero.\r\n          xc[0] = x.e = 0;\r\n        }\r\n      } else {\r\n\r\n        // Remove any digits after the required decimal places.\r\n        xc.length = i--;\r\n\r\n        // Round up?\r\n        if (more) {\r\n\r\n          // Rounding up may mean the previous digit has to be rounded up.\r\n          for (; ++xc[i] > 9;) {\r\n            xc[i] = 0;\r\n            if (!i--) {\r\n              ++x.e;\r\n              xc.unshift(1);\r\n            }\r\n          }\r\n        }\r\n\r\n        // Remove trailing zeros.\r\n        for (i = xc.length; !xc[--i];) xc.pop();\r\n      }\r\n    } else if (rm < 0 || rm > 3 || rm !== ~~rm) {\r\n      throw Error(INVALID_RM);\r\n    }\r\n\r\n    return x;\r\n  }\r\n\r\n\r\n  /*\r\n   * Return a string representing the value of Big x in normal or exponential notation.\r\n   * Handles P.toExponential, P.toFixed, P.toJSON, P.toPrecision, P.toString and P.valueOf.\r\n   *\r\n   * x {Big}\r\n   * id? {number} Caller id.\r\n   *         1 toExponential\r\n   *         2 toFixed\r\n   *         3 toPrecision\r\n   *         4 valueOf\r\n   * n? {number|undefined} Caller's argument.\r\n   * k? {number|undefined}\r\n   */\r\n  function stringify(x, id, n, k) {\r\n    var e, s,\r\n      Big = x.constructor,\r\n      z = !x.c[0];\r\n\r\n    if (n !== UNDEFINED) {\r\n      if (n !== ~~n || n < (id == 3) || n > MAX_DP) {\r\n        throw Error(id == 3 ? INVALID + 'precision' : INVALID_DP);\r\n      }\r\n\r\n      x = new Big(x);\r\n\r\n      // The index of the digit that may be rounded up.\r\n      n = k - x.e;\r\n\r\n      // Round?\r\n      if (x.c.length > ++k) round(x, n, Big.RM);\r\n\r\n      // toFixed: recalculate k as x.e may have changed if value rounded up.\r\n      if (id == 2) k = x.e + n + 1;\r\n\r\n      // Append zeros?\r\n      for (; x.c.length < k;) x.c.push(0);\r\n    }\r\n\r\n    e = x.e;\r\n    s = x.c.join('');\r\n    n = s.length;\r\n\r\n    // Exponential notation?\r\n    if (id != 2 && (id == 1 || id == 3 && k <= e || e <= Big.NE || e >= Big.PE)) {\r\n      s = s.charAt(0) + (n > 1 ? '.' + s.slice(1) : '') + (e < 0 ? 'e' : 'e+') + e;\r\n\r\n    // Normal notation.\r\n    } else if (e < 0) {\r\n      for (; ++e;) s = '0' + s;\r\n      s = '0.' + s;\r\n    } else if (e > 0) {\r\n      if (++e > n) for (e -= n; e--;) s += '0';\r\n      else if (e < n) s = s.slice(0, e) + '.' + s.slice(e);\r\n    } else if (n > 1) {\r\n      s = s.charAt(0) + '.' + s.slice(1);\r\n    }\r\n\r\n    return x.s < 0 && (!z || id == 4) ? '-' + s : s;\r\n  }\r\n\r\n\r\n  // Prototype/instance methods\r\n\r\n\r\n  /*\r\n   * Return a new Big whose value is the absolute value of this Big.\r\n   */\r\n  P.abs = function () {\r\n    var x = new this.constructor(this);\r\n    x.s = 1;\r\n    return x;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return 1 if the value of this Big is greater than the value of Big y,\r\n   *       -1 if the value of this Big is less than the value of Big y, or\r\n   *        0 if they have the same value.\r\n  */\r\n  P.cmp = function (y) {\r\n    var isneg,\r\n      x = this,\r\n      xc = x.c,\r\n      yc = (y = new x.constructor(y)).c,\r\n      i = x.s,\r\n      j = y.s,\r\n      k = x.e,\r\n      l = y.e;\r\n\r\n    // Either zero?\r\n    if (!xc[0] || !yc[0]) return !xc[0] ? !yc[0] ? 0 : -j : i;\r\n\r\n    // Signs differ?\r\n    if (i != j) return i;\r\n\r\n    isneg = i < 0;\r\n\r\n    // Compare exponents.\r\n    if (k != l) return k > l ^ isneg ? 1 : -1;\r\n\r\n    j = (k = xc.length) < (l = yc.length) ? k : l;\r\n\r\n    // Compare digit by digit.\r\n    for (i = -1; ++i < j;) {\r\n      if (xc[i] != yc[i]) return xc[i] > yc[i] ^ isneg ? 1 : -1;\r\n    }\r\n\r\n    // Compare lengths.\r\n    return k == l ? 0 : k > l ^ isneg ? 1 : -1;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a new Big whose value is the value of this Big divided by the value of Big y, rounded,\r\n   * if necessary, to a maximum of Big.DP decimal places using rounding mode Big.RM.\r\n   */\r\n  P.div = function (y) {\r\n    var x = this,\r\n      Big = x.constructor,\r\n      a = x.c,                  // dividend\r\n      b = (y = new Big(y)).c,   // divisor\r\n      k = x.s == y.s ? 1 : -1,\r\n      dp = Big.DP;\r\n\r\n    if (dp !== ~~dp || dp < 0 || dp > MAX_DP) throw Error(INVALID_DP);\r\n\r\n    // Divisor is zero?\r\n    if (!b[0]) throw Error(DIV_BY_ZERO);\r\n\r\n    // Dividend is 0? Return +-0.\r\n    if (!a[0]) return new Big(k * 0);\r\n\r\n    var bl, bt, n, cmp, ri,\r\n      bz = b.slice(),\r\n      ai = bl = b.length,\r\n      al = a.length,\r\n      r = a.slice(0, bl),   // remainder\r\n      rl = r.length,\r\n      q = y,                // quotient\r\n      qc = q.c = [],\r\n      qi = 0,\r\n      d = dp + (q.e = x.e - y.e) + 1;    // number of digits of the result\r\n\r\n    q.s = k;\r\n    k = d < 0 ? 0 : d;\r\n\r\n    // Create version of divisor with leading zero.\r\n    bz.unshift(0);\r\n\r\n    // Add zeros to make remainder as long as divisor.\r\n    for (; rl++ < bl;) r.push(0);\r\n\r\n    do {\r\n\r\n      // n is how many times the divisor goes into current remainder.\r\n      for (n = 0; n < 10; n++) {\r\n\r\n        // Compare divisor and remainder.\r\n        if (bl != (rl = r.length)) {\r\n          cmp = bl > rl ? 1 : -1;\r\n        } else {\r\n          for (ri = -1, cmp = 0; ++ri < bl;) {\r\n            if (b[ri] != r[ri]) {\r\n              cmp = b[ri] > r[ri] ? 1 : -1;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        // If divisor < remainder, subtract divisor from remainder.\r\n        if (cmp < 0) {\r\n\r\n          // Remainder can't be more than 1 digit longer than divisor.\r\n          // Equalise lengths using divisor with extra leading zero?\r\n          for (bt = rl == bl ? b : bz; rl;) {\r\n            if (r[--rl] < bt[rl]) {\r\n              ri = rl;\r\n              for (; ri && !r[--ri];) r[ri] = 9;\r\n              --r[ri];\r\n              r[rl] += 10;\r\n            }\r\n            r[rl] -= bt[rl];\r\n          }\r\n\r\n          for (; !r[0];) r.shift();\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n\r\n      // Add the digit n to the result array.\r\n      qc[qi++] = cmp ? n : ++n;\r\n\r\n      // Update the remainder.\r\n      if (r[0] && cmp) r[rl] = a[ai] || 0;\r\n      else r = [a[ai]];\r\n\r\n    } while ((ai++ < al || r[0] !== UNDEFINED) && k--);\r\n\r\n    // Leading zero? Do not remove if result is simply zero (qi == 1).\r\n    if (!qc[0] && qi != 1) {\r\n\r\n      // There can't be more than one zero.\r\n      qc.shift();\r\n      q.e--;\r\n    }\r\n\r\n    // Round?\r\n    if (qi > d) round(q, dp, Big.RM, r[0] !== UNDEFINED);\r\n\r\n    return q;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return true if the value of this Big is equal to the value of Big y, otherwise return false.\r\n   */\r\n  P.eq = function (y) {\r\n    return !this.cmp(y);\r\n  };\r\n\r\n\r\n  /*\r\n   * Return true if the value of this Big is greater than the value of Big y, otherwise return\r\n   * false.\r\n   */\r\n  P.gt = function (y) {\r\n    return this.cmp(y) > 0;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return true if the value of this Big is greater than or equal to the value of Big y, otherwise\r\n   * return false.\r\n   */\r\n  P.gte = function (y) {\r\n    return this.cmp(y) > -1;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return true if the value of this Big is less than the value of Big y, otherwise return false.\r\n   */\r\n  P.lt = function (y) {\r\n    return this.cmp(y) < 0;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return true if the value of this Big is less than or equal to the value of Big y, otherwise\r\n   * return false.\r\n   */\r\n  P.lte = function (y) {\r\n    return this.cmp(y) < 1;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a new Big whose value is the value of this Big minus the value of Big y.\r\n   */\r\n  P.minus = P.sub = function (y) {\r\n    var i, j, t, xlty,\r\n      x = this,\r\n      Big = x.constructor,\r\n      a = x.s,\r\n      b = (y = new Big(y)).s;\r\n\r\n    // Signs differ?\r\n    if (a != b) {\r\n      y.s = -b;\r\n      return x.plus(y);\r\n    }\r\n\r\n    var xc = x.c.slice(),\r\n      xe = x.e,\r\n      yc = y.c,\r\n      ye = y.e;\r\n\r\n    // Either zero?\r\n    if (!xc[0] || !yc[0]) {\r\n\r\n      // y is non-zero? x is non-zero? Or both are zero.\r\n      return yc[0] ? (y.s = -b, y) : new Big(xc[0] ? x : 0);\r\n    }\r\n\r\n    // Determine which is the bigger number. Prepend zeros to equalise exponents.\r\n    if (a = xe - ye) {\r\n\r\n      if (xlty = a < 0) {\r\n        a = -a;\r\n        t = xc;\r\n      } else {\r\n        ye = xe;\r\n        t = yc;\r\n      }\r\n\r\n      t.reverse();\r\n      for (b = a; b--;) t.push(0);\r\n      t.reverse();\r\n    } else {\r\n\r\n      // Exponents equal. Check digit by digit.\r\n      j = ((xlty = xc.length < yc.length) ? xc : yc).length;\r\n\r\n      for (a = b = 0; b < j; b++) {\r\n        if (xc[b] != yc[b]) {\r\n          xlty = xc[b] < yc[b];\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    // x < y? Point xc to the array of the bigger number.\r\n    if (xlty) {\r\n      t = xc;\r\n      xc = yc;\r\n      yc = t;\r\n      y.s = -y.s;\r\n    }\r\n\r\n    /*\r\n     * Append zeros to xc if shorter. No need to add zeros to yc if shorter as subtraction only\r\n     * needs to start at yc.length.\r\n     */\r\n    if ((b = (j = yc.length) - (i = xc.length)) > 0) for (; b--;) xc[i++] = 0;\r\n\r\n    // Subtract yc from xc.\r\n    for (b = i; j > a;) {\r\n      if (xc[--j] < yc[j]) {\r\n        for (i = j; i && !xc[--i];) xc[i] = 9;\r\n        --xc[i];\r\n        xc[j] += 10;\r\n      }\r\n\r\n      xc[j] -= yc[j];\r\n    }\r\n\r\n    // Remove trailing zeros.\r\n    for (; xc[--b] === 0;) xc.pop();\r\n\r\n    // Remove leading zeros and adjust exponent accordingly.\r\n    for (; xc[0] === 0;) {\r\n      xc.shift();\r\n      --ye;\r\n    }\r\n\r\n    if (!xc[0]) {\r\n\r\n      // n - n = +0\r\n      y.s = 1;\r\n\r\n      // Result must be zero.\r\n      xc = [ye = 0];\r\n    }\r\n\r\n    y.c = xc;\r\n    y.e = ye;\r\n\r\n    return y;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a new Big whose value is the value of this Big modulo the value of Big y.\r\n   */\r\n  P.mod = function (y) {\r\n    var ygtx,\r\n      x = this,\r\n      Big = x.constructor,\r\n      a = x.s,\r\n      b = (y = new Big(y)).s;\r\n\r\n    if (!y.c[0]) throw Error(DIV_BY_ZERO);\r\n\r\n    x.s = y.s = 1;\r\n    ygtx = y.cmp(x) == 1;\r\n    x.s = a;\r\n    y.s = b;\r\n\r\n    if (ygtx) return new Big(x);\r\n\r\n    a = Big.DP;\r\n    b = Big.RM;\r\n    Big.DP = Big.RM = 0;\r\n    x = x.div(y);\r\n    Big.DP = a;\r\n    Big.RM = b;\r\n\r\n    return this.minus(x.times(y));\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a new Big whose value is the value of this Big plus the value of Big y.\r\n   */\r\n  P.plus = P.add = function (y) {\r\n    var t,\r\n      x = this,\r\n      Big = x.constructor,\r\n      a = x.s,\r\n      b = (y = new Big(y)).s;\r\n\r\n    // Signs differ?\r\n    if (a != b) {\r\n      y.s = -b;\r\n      return x.minus(y);\r\n    }\r\n\r\n    var xe = x.e,\r\n      xc = x.c,\r\n      ye = y.e,\r\n      yc = y.c;\r\n\r\n    // Either zero? y is non-zero? x is non-zero? Or both are zero.\r\n    if (!xc[0] || !yc[0]) return yc[0] ? y : new Big(xc[0] ? x : a * 0);\r\n\r\n    xc = xc.slice();\r\n\r\n    // Prepend zeros to equalise exponents.\r\n    // Note: reverse faster than unshifts.\r\n    if (a = xe - ye) {\r\n      if (a > 0) {\r\n        ye = xe;\r\n        t = yc;\r\n      } else {\r\n        a = -a;\r\n        t = xc;\r\n      }\r\n\r\n      t.reverse();\r\n      for (; a--;) t.push(0);\r\n      t.reverse();\r\n    }\r\n\r\n    // Point xc to the longer array.\r\n    if (xc.length - yc.length < 0) {\r\n      t = yc;\r\n      yc = xc;\r\n      xc = t;\r\n    }\r\n\r\n    a = yc.length;\r\n\r\n    // Only start adding at yc.length - 1 as the further digits of xc can be left as they are.\r\n    for (b = 0; a; xc[a] %= 10) b = (xc[--a] = xc[a] + yc[a] + b) / 10 | 0;\r\n\r\n    // No need to check for zero, as +x + +y != 0 && -x + -y != 0\r\n\r\n    if (b) {\r\n      xc.unshift(b);\r\n      ++ye;\r\n    }\r\n\r\n    // Remove trailing zeros.\r\n    for (a = xc.length; xc[--a] === 0;) xc.pop();\r\n\r\n    y.c = xc;\r\n    y.e = ye;\r\n\r\n    return y;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a Big whose value is the value of this Big raised to the power n.\r\n   * If n is negative, round to a maximum of Big.DP decimal places using rounding\r\n   * mode Big.RM.\r\n   *\r\n   * n {number} Integer, -MAX_POWER to MAX_POWER inclusive.\r\n   */\r\n  P.pow = function (n) {\r\n    var x = this,\r\n      one = new x.constructor(1),\r\n      y = one,\r\n      isneg = n < 0;\r\n\r\n    if (n !== ~~n || n < -MAX_POWER || n > MAX_POWER) throw Error(INVALID + 'exponent');\r\n    if (isneg) n = -n;\r\n\r\n    for (;;) {\r\n      if (n & 1) y = y.times(x);\r\n      n >>= 1;\r\n      if (!n) break;\r\n      x = x.times(x);\r\n    }\r\n\r\n    return isneg ? one.div(y) : y;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a new Big whose value is the value of this Big rounded using rounding mode rm\r\n   * to a maximum of dp decimal places, or, if dp is negative, to an integer which is a\r\n   * multiple of 10**-dp.\r\n   * If dp is not specified, round to 0 decimal places.\r\n   * If rm is not specified, use Big.RM.\r\n   *\r\n   * dp? {number} Integer, -MAX_DP to MAX_DP inclusive.\r\n   * rm? 0, 1, 2 or 3 (ROUND_DOWN, ROUND_HALF_UP, ROUND_HALF_EVEN, ROUND_UP)\r\n   */\r\n  P.round = function (dp, rm) {\r\n    var Big = this.constructor;\r\n    if (dp === UNDEFINED) dp = 0;\r\n    else if (dp !== ~~dp || dp < -MAX_DP || dp > MAX_DP) throw Error(INVALID_DP);\r\n    return round(new Big(this), dp, rm === UNDEFINED ? Big.RM : rm);\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a new Big whose value is the square root of the value of this Big, rounded, if\r\n   * necessary, to a maximum of Big.DP decimal places using rounding mode Big.RM.\r\n   */\r\n  P.sqrt = function () {\r\n    var r, c, t,\r\n      x = this,\r\n      Big = x.constructor,\r\n      s = x.s,\r\n      e = x.e,\r\n      half = new Big(0.5);\r\n\r\n    // Zero?\r\n    if (!x.c[0]) return new Big(x);\r\n\r\n    // Negative?\r\n    if (s < 0) throw Error(NAME + 'No square root');\r\n\r\n    // Estimate.\r\n    s = Math.sqrt(x + '');\r\n\r\n    // Math.sqrt underflow/overflow?\r\n    // Re-estimate: pass x coefficient to Math.sqrt as integer, then adjust the result exponent.\r\n    if (s === 0 || s === 1 / 0) {\r\n      c = x.c.join('');\r\n      if (!(c.length + e & 1)) c += '0';\r\n      s = Math.sqrt(c);\r\n      e = ((e + 1) / 2 | 0) - (e < 0 || e & 1);\r\n      r = new Big((s == 1 / 0 ? '1e' : (s = s.toExponential()).slice(0, s.indexOf('e') + 1)) + e);\r\n    } else {\r\n      r = new Big(s);\r\n    }\r\n\r\n    e = r.e + (Big.DP += 4);\r\n\r\n    // Newton-Raphson iteration.\r\n    do {\r\n      t = r;\r\n      r = half.times(t.plus(x.div(t)));\r\n    } while (t.c.slice(0, e).join('') !== r.c.slice(0, e).join(''));\r\n\r\n    return round(r, Big.DP -= 4, Big.RM);\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a new Big whose value is the value of this Big times the value of Big y.\r\n   */\r\n  P.times = P.mul = function (y) {\r\n    var c,\r\n      x = this,\r\n      Big = x.constructor,\r\n      xc = x.c,\r\n      yc = (y = new Big(y)).c,\r\n      a = xc.length,\r\n      b = yc.length,\r\n      i = x.e,\r\n      j = y.e;\r\n\r\n    // Determine sign of result.\r\n    y.s = x.s == y.s ? 1 : -1;\r\n\r\n    // Return signed 0 if either 0.\r\n    if (!xc[0] || !yc[0]) return new Big(y.s * 0);\r\n\r\n    // Initialise exponent of result as x.e + y.e.\r\n    y.e = i + j;\r\n\r\n    // If array xc has fewer digits than yc, swap xc and yc, and lengths.\r\n    if (a < b) {\r\n      c = xc;\r\n      xc = yc;\r\n      yc = c;\r\n      j = a;\r\n      a = b;\r\n      b = j;\r\n    }\r\n\r\n    // Initialise coefficient array of result with zeros.\r\n    for (c = new Array(j = a + b); j--;) c[j] = 0;\r\n\r\n    // Multiply.\r\n\r\n    // i is initially xc.length.\r\n    for (i = b; i--;) {\r\n      b = 0;\r\n\r\n      // a is yc.length.\r\n      for (j = a + i; j > i;) {\r\n\r\n        // Current sum of products at this digit position, plus carry.\r\n        b = c[j] + yc[i] * xc[j - i - 1] + b;\r\n        c[j--] = b % 10;\r\n\r\n        // carry\r\n        b = b / 10 | 0;\r\n      }\r\n\r\n      c[j] = (c[j] + b) % 10;\r\n    }\r\n\r\n    // Increment result exponent if there is a final carry, otherwise remove leading zero.\r\n    if (b) ++y.e;\r\n    else c.shift();\r\n\r\n    // Remove trailing zeros.\r\n    for (i = c.length; !c[--i];) c.pop();\r\n    y.c = c;\r\n\r\n    return y;\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a string representing the value of this Big in exponential notation to dp fixed decimal\r\n   * places and rounded using Big.RM.\r\n   *\r\n   * dp? {number} Integer, 0 to MAX_DP inclusive.\r\n   */\r\n  P.toExponential = function (dp) {\r\n    return stringify(this, 1, dp, dp);\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a string representing the value of this Big in normal notation to dp fixed decimal\r\n   * places and rounded using Big.RM.\r\n   *\r\n   * dp? {number} Integer, 0 to MAX_DP inclusive.\r\n   *\r\n   * (-0).toFixed(0) is '0', but (-0.1).toFixed(0) is '-0'.\r\n   * (-0).toFixed(1) is '0.0', but (-0.01).toFixed(1) is '-0.0'.\r\n   */\r\n  P.toFixed = function (dp) {\r\n    return stringify(this, 2, dp, this.e + dp);\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a string representing the value of this Big rounded to sd significant digits using\r\n   * Big.RM. Use exponential notation if sd is less than the number of digits necessary to represent\r\n   * the integer part of the value in normal notation.\r\n   *\r\n   * sd {number} Integer, 1 to MAX_DP inclusive.\r\n   */\r\n  P.toPrecision = function (sd) {\r\n    return stringify(this, 3, sd, sd - 1);\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a string representing the value of this Big.\r\n   * Return exponential notation if this Big has a positive exponent equal to or greater than\r\n   * Big.PE, or a negative exponent equal to or less than Big.NE.\r\n   * Omit the sign for negative zero.\r\n   */\r\n  P.toString = function () {\r\n    return stringify(this);\r\n  };\r\n\r\n\r\n  /*\r\n   * Return a string representing the value of this Big.\r\n   * Return exponential notation if this Big has a positive exponent equal to or greater than\r\n   * Big.PE, or a negative exponent equal to or less than Big.NE.\r\n   * Include the sign for negative zero.\r\n   */\r\n  P.valueOf = P.toJSON = function () {\r\n    return stringify(this, 4);\r\n  };\r\n\r\n\r\n  // Export\r\n\r\n\r\n  Big = _Big_();\r\n\r\n  Big['default'] = Big.Big = Big;\r\n\r\n  //AMD.\r\n  if (typeof define === 'function' && define.amd) {\r\n    define(function () { return Big; });\r\n\r\n  // Node and other CommonJS-like environments that support module.exports.\r\n  } else if (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = Big;\r\n\r\n  //Browser.\r\n  } else {\r\n    GLOBAL.Big = Big;\r\n  }\r\n})(this);\r\n"],"sourceRoot":""}